# /cft:spec-delete で GitHub Issue のクローズはオプションなしでできるようにしたい

**仕様書 ID:** de53d0d8-2ff7-4e12-86c6-ec0dd09cc908
**フェーズ:** requirements
**作成日時:** 2025/11/23 15:35:13
**更新日時:** 2025/11/23 15:35:13

---

## 1. 背景と目的

### 背景

現在、`/cft:spec-delete` コマンドで仕様書を削除する際、関連する GitHub Issue をクローズするには `--close-github-issue` オプションを明示的に指定する必要があります。しかし、仕様書削除時には通常 GitHub Issue も不要になるため、毎回オプションを指定するのは手間です。

また、フェーズ `completed` 時には GitHub Issue が自動的にクローズされる実装があり、一貫性の観点からも仕様書削除時にも自動クローズが望ましいと考えられます。

### 目的

- `/cft:spec-delete` コマンド実行時、デフォルトで GitHub Issue を自動的にクローズできるようにする
- オプション指定の手間を削減し、ユーザー体験を向上させる
- GitHub 統合の一貫性を保つ（completed フェーズと同様の自動クローズ動作）

---

## 2. 対象ユーザー

- **cc-craft-kit を使用する開発者**
  - 仕様書と GitHub Issue を統合して管理している開発者
  - 仕様書削除時に手動で GitHub Issue をクローズする手間を削減したいユーザー

---

## 3. 受け入れ基準

### 必須要件

- [ ] `/cft:spec-delete` コマンドをオプションなしで実行した際、GitHub Issue がデフォルトで自動的にクローズされること
- [ ] `--close-github-issue` オプションを指定した場合も正常に動作すること（後方互換性）
- [ ] GitHub 未設定時や GitHub Issue が存在しない場合でも、エラーなく仕様書削除が完了すること

### 機能要件

- [ ] `src/commands/spec/delete.ts` の `closeGitHubIssue` のデフォルト値を `false` から `true` に変更すること
- [ ] 確認プロンプトに「GitHub Issue がクローズされる」旨のメッセージが表示されること
- [ ] GitHub API エラー時（404, 401, 403, 500）のエラーハンドリングが正常に動作すること
- [ ] スラッシュコマンドのドキュメント（`src/slash-commands/spec-delete.md`）を更新すること

### 非機能要件

- [ ] 既存のエラーハンドリング、トランザクション設計を変更しないこと
- [ ] GitHub API レート制限に配慮した実装であること
- [ ] 型安全性（TypeScript strict mode）を維持すること

---

## 4. 制約条件

- **技術的制約**
  - CLI パーサーは Node.js 標準の `process.argv` を使用（外部ライブラリ非依存）
  - GitHub API レート制限: 認証あり 5,000 requests/hour、認証なし 60 requests/hour
  - TypeScript strict mode を有効にした型チェックが必須

- **互換性制約**
  - 既存の `--close-github-issue` オプションは後方互換性のため維持すること
  - 既存のエラーハンドリングロジックを変更しないこと
  - 確認プロンプト（`--yes` オプション）の動作を変更しないこと

- **安全性制約**
  - GitHub Issue クローズ失敗時、仕様書削除処理をロールバックすること（既存の動作を維持）
  - GITHUB_TOKEN 未設定時は適切なエラーメッセージを表示すること

---

## 5. 依存関係

- **ファイル依存**
  - `src/commands/spec/delete.ts` - メイン実装ファイル（デフォルト値変更）
  - `src/slash-commands/spec-delete.md` - ドキュメント更新
  - `src/integrations/github/issues.ts` - GitHub API クライアント（変更なし）

- **関連する既存機能**
  - フェーズ `completed` 時の自動 Issue クローズ機能（`src/core/workflow/github-integration.ts:384-414`）
  - GitHub 統合の初期化（`/cft:github-init`）
  - GitHub Issue 自動リカバリー（`ensureGitHubIssue`）

- **外部依存**
  - GitHub API (REST API v3)
  - 環境変数 `GITHUB_TOKEN`（GitHub 認証）

---

## 6. 参考情報

- **実装ファイル**
  - `src/commands/spec/delete.ts:64` - デフォルト値定義箇所
  - `src/commands/spec/delete.ts:151-228` - GitHub Issue クローズロジック
  - `src/core/workflow/github-integration.ts:384-414` - completed フェーズの自動クローズ実装

- **設計指針**
  - コードベース解析の推奨設計: デフォルト値を `false` → `true` に変更（1行の変更）
  - 既存のエラーハンドリング、確認プロンプトはそのまま活用
  - 後方互換性を維持（破壊的変更なし）

- **GitHub API ドキュメント**
  - [GitHub REST API - Issues](https://docs.github.com/en/rest/issues/issues#update-an-issue)
  - [GitHub API レート制限](https://docs.github.com/en/rest/rate-limit)
