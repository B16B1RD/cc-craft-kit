---
id: "bcc860f0-80cd-487c-a6b5-aab53e496f3d"
name: "/cft:status で表示されるフェーズごとの件数が正しくない"
phase: "requirements"
branch_name: "fix/spec-bcc860f0-status-phase-count-incorrect"
github_issue_number: null
pr_url: null
created_at: "2025-12-07T07:00:00.000Z"
updated_at: "2025-12-07T07:00:00.000Z"
---

# /cft:status で表示されるフェーズごとの件数が正しくない

## 1. 背景と目的

### 背景

`/cft:status` および `/cft:spec list` コマンドでフェーズごとの仕様書件数を集計・フィルタリングする際、以下の問題が発生している:

**問題1: grep による集計が不正確**

```bash
grep -h '^phase:' .cc-craft-kit/specs/*.md 2>/dev/null | sort | uniq -c | sort -rn
```

この方法では、YAML フロントマター内の `phase:` だけでなく、仕様書本文中に記載されたテンプレートや例示（例: `phase: design`）も含めてカウントしてしまう。

**問題2: grep によるフィルタリングが不正確**

```bash
grep -l 'phase: "design"\|phase: design' .cc-craft-kit/specs/*.md
```

同様に、本文中の記述もマッチしてしまい、実際のフェーズと異なるファイルが検出される。

**実例（会話ログより）:**
- `/cft:status` で `design: 1` と表示されたが、実際には design フェーズの仕様書は 0 件
- `grep -rn 'phase: design'` で検索すると、`035d4de4...md:212:phase: design` のように本文中の記述がヒット

### 目的

YAML フロントマター内の `phase:` フィールドのみを正確に解析し、フェーズごとの件数集計およびフィルタリングを正しく行えるようにする。

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] `/cft:status` でフェーズごとの件数が正確に表示される
- [ ] `/cft:spec list <phase>` で指定フェーズの仕様書のみが表示される

### 機能要件

- [ ] YAML フロントマター（先頭の `---` ～ 2番目の `---` の間）のみを解析対象とする
- [ ] 本文中に `phase:` が含まれていても集計・フィルタリングに影響しない
- [ ] 引用符の有無（`phase: "design"` と `phase: design`）の両方に対応

### 非機能要件

- [ ] 193 件以上の仕様書でも高速に処理できる（1秒以内）
- [ ] TypeScript を使用しない（スラッシュコマンドのみで実装）

---

## 4. 制約条件

- スラッシュコマンド（.md ファイル）のみで実装
- TypeScript は使用しない
- gh CLI と標準的な Unix コマンドのみ使用可能

---

## 5. 依存関係

- `.claude/commands/cft/spec.md` - list サブコマンドの実装
- `.claude/commands/cft/status.md` - status コマンドの実装

---

## 6. 参考情報

- 発生時の会話ログ: ユーザー提供の詳細なログを参照
- 問題のある grep パターン: `grep -h '^phase:'` は先頭のみマッチするが、YAML フロントマター外の行頭もマッチする
