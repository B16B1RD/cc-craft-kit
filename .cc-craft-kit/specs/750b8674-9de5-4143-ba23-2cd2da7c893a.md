---
id: "750b8674-9de5-4143-ba23-2cd2da7c893a"
name: "completed フェーズで仕様書のフェーズを completed に変更している"
phase: "requirements"
branch_name: "fix/spec-750b8674-completed-phase-timing"
github_issue_number: null
created_at: "2025-12-06T12:00:00+09:00"
updated_at: "2025-12-06T12:00:00+09:00"
---

# completed フェーズで仕様書のフェーズを completed に変更している

## 1. 背景と目的

### 背景

completed フェーズは、PR マージ後に実行されるので、仕様書は review フェーズの PR 作成前に completed にフェーズ変更しておくべきである。

現在の実装では、`/cft:spec phase <id> completed` を実行すると、以下の問題が発生する:

1. completed フェーズで仕様書の `phase` を `completed` に変更してコミット
2. その後、develop ブランチに切り替え
3. 作業ブランチを削除

この順序では、作業ブランチで行った `phase: completed` への変更が develop ブランチに反映されない（PR がまだマージされていないため）。

### 目的

- completed フェーズの「ケース B: PR がマージされていない、または PR がない場合」の処理を修正する
- 作業ブランチでコミットした変更が develop に反映されるよう、処理フローを見直す

---

## 2. 対象ユーザー

- cc-craft-kit を使用して仕様駆動開発を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] completed フェーズ実行後、develop ブランチで仕様書が `phase: completed` になっていること

### 機能要件

- [ ] ケース B（PR 未マージ/PR なし）で、作業ブランチの変更を develop にマージしてから完了処理を行う

### 非機能要件

- [ ] 既存の仕様書の整合性を壊さないこと
- [ ] ケース A（PR マージ済み）の処理は変更しないこと

---

## 4. 制約条件

- スラッシュコマンド（.md ファイル）のみで実装すること
- TypeScript/npm は使用しないこと

---

## 5. 依存関係

- `.claude/commands/cft/spec.md` の `phase` サブコマンド

---

## 6. 参考情報

- 関連ファイル: `.claude/commands/cft/spec.md`
