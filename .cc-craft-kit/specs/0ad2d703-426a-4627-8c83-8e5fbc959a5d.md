# /cft:sepc-create 完了時、対応する GitHub Issue の本文がテンプレートのまま

**仕様書 ID:** 0ad2d703-426a-4627-8c83-8e5fbc959a5d
**フェーズ:** requirements
**作成日時:** 2025/11/28 00:00:00
**更新日時:** 2025/11/28 00:00:00

---

## 1. 背景と目的

### 背景

要件定義が自動生成されているはずなので、本文にはそれが反映されるべき。

### 目的

`/cft:spec-create` コマンド完了時に作成される GitHub Issue の本文に、自動生成された仕様書の要件定義内容を反映させる。現在はテンプレート状態のまま Issue が作成されており、後から手動で更新が必要になっている。

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発（SDD）を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] `/cft:spec-create` 完了時、GitHub Issue 本文に自動生成された仕様書内容が反映される
- [ ] 既存の仕様書作成ワークフローが破壊されない

### 機能要件

- [ ] spec-create.md の Step 順序を変更し、仕様書自動完成（Step 8, 9）を DB 登録（Step 7）より前に実行する
- [ ] DB 登録時に完成した仕様書内容が GitHub Issue に反映される

### 非機能要件

- [ ] プロンプトベースの解決策を採用する（CLAUDE.md のプロンプトファースト原則に従う）
- [ ] 既存のスクリプト（register.ts, github-integration.ts）への変更を最小限に抑える

---

## 4. 制約条件

- spec-create.md のみの修正で解決する（スクリプト変更なし）
- Step 7（DB 登録）実行時に `spec.created` イベントが発火し、GitHub Issue が自動作成される動作は維持
- ロールバック処理の順序も Step 順序変更に合わせて調整が必要

---

## 5. 依存関係

- `src/slash-commands/spec-create.md` - コマンド定義（修正対象）
- `src/core/spec/register-spec.ts` - DB 登録 + イベント発火
- `src/core/workflow/github-integration.ts` - spec.created イベントハンドラー
- `src/integrations/github/sync.ts` - buildIssueBody() で仕様書ファイルを読み込む

---

## 6. 参考情報

- 問題の根本原因: Step 7（DB 登録 + Issue 作成）が Step 8・9（仕様書自動完成）より先に実行される
- 解決策: spec-create.md の Step 順序を変更（Step 6 → Step 8 → Step 9 → Step 7 → Step 10）
- 修正後のフロー図:
  ```
  Step 6: 仕様書ファイル作成（テンプレート）
      ↓
  Step 8: コードベース解析
      ↓
  Step 9: 仕様書自動完成（テンプレート → 完成版）
      ↓
  Step 7: DB 登録 + GitHub Issue 作成（完成した仕様書から）
      ↓
  Step 10: 元ブランチに復帰
  ```
