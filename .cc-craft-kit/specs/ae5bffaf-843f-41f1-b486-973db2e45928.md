# ビルドプロセス削除テスト

**仕様書ID**: ae5bffaf-843f-41f1-b486-973db2e45928
**フェーズ**: design
**作成日**: 2025/11/18
**更新日**: 2025/11/18

---

## 1. 概要

TypeScript 直接実行への移行テストを行う仕様書です。ビルドプロセス（`npm run build`）を削除し、`npx tsx`による直接実行方式の動作確認を目的としています。

## 2. 背景と目的

### 背景

cc-craft-kit プロジェクトでは、ドッグフーディング（自分自身を使って開発）を実現するため、`src/` のソースコードを `.cc-craft-kit/` へコピーする同期プロセスを採用しています。

現在の課題は以下の通りです。

- `npm run build` で TypeScript コンパイルしているが、実際には `npx tsx` で直接実行している
- ビルド成果物（`dist/`）は使用されていない
- 同期プロセスは `npm run sync:dogfood` で TypeScript ファイルをそのままコピーしている

### 目的

1. ビルドプロセスの完全削除が可能かを検証
2. TypeScript 直接実行方式の動作確認
3. 開発ワークフローの簡素化

## 3. 受け入れ基準

- [ ] `npm run build`コマンドが削除されても、すべてのスラッシュコマンドが正常に動作する
- [ ] `npx tsx .cc-craft-kit/commands/**/*.ts`形式での直接実行が可能
- [ ] `package.json`からビルド関連スクリプトが削除されている
- [ ] ドキュメント（README.md, CLAUDE.md）がビルドレス方式に更新されている
- [ ] 既存の同期プロセス（`npm run sync:dogfood`）が正常に動作する

## 4. アーキテクチャ設計

### 4.1 現在のアーキテクチャ

```text
src/ (TypeScript開発コード)
  ↓ npm run build (tsc)
dist/ (JavaScript成果物) ← 実際には未使用
  ↓ npm run sync:dogfood (TypeScriptファイルをコピー)
.cc-craft-kit/ (TypeScriptファイル)
  ↓ npx tsx で直接実行
実行
```

### 4.2 新アーキテクチャ（ビルドレス）

```text
src/ (TypeScript開発コード)
  ↓ npm run sync:dogfood (TypeScriptファイルをコピー)
.cc-craft-kit/ (TypeScriptファイル)
  ↓ npx tsx で直接実行
実行
```

### 4.3 影響範囲

| コンポーネント | 変更内容 | 影響度 |
|---|---|---|
| package.json | `build`, `build:dogfood`スクリプト削除 | 中 |
| dist/ | ディレクトリ削除 | 低 |
| .gitignore | `dist/`エントリ削除 | 低 |
| ドキュメント | ビルド手順削除 | 中 |
| CI/CD | ビルドステップ削除（存在する場合） | 低 |

## 5. データモデル

### 影響なし

このテストは実行方式の変更であり、データベーススキーマやデータモデルへの影響はありません。

## 6. API設計

### 影響なし

外部 API や内部 API の変更はありません。すべてのコマンドは従来通り動作します。

## 7. セキュリティ考慮事項

### リスク評価

| リスク | 影響 | 対策 |
|---|---|---|
| TypeScript直接実行時の型安全性 | 低 | tsxは内部でTypeScriptコンパイラを使用するため、型チェックは維持される |
| 依存関係の脆弱性 | 低 | `tsx`パッケージは既に使用中であり、新規導入ではない |

### セキュリティチェックリスト

- [x] 型安全性が維持されることを確認
- [x] 既存のセキュリティ対策（入力検証、パラメータ化クエリ等）が影響を受けないことを確認
- [x] 環境変数管理（.env）が引き続き機能することを確認

## 8. テスト戦略

### 8.1 動作確認テスト

以下のコマンドを実行し、すべて正常に動作することを確認します。

1. `/cc-craft-kit:status` - プロジェクト状況の表示
2. `/cc-craft-kit:spec-list` - 仕様書の一覧表示
3. `/cc-craft-kit:spec-get ae5bffaf` - 仕様書の詳細表示
4. `/cc-craft-kit:spec-phase ae5bffaf tasks` - フェーズ更新
5. `/cc-craft-kit:github-init <owner> <repo>` - GitHub 統合（Dry-run）

### 8.2 同期プロセステスト

1. `src/`のファイルを編集
2. `npm run sync:dogfood`実行
3. `.cc-craft-kit/`への反映確認
4. `npm run check:sync`で整合性確認

### 8.3 型チェックテスト

```bash
# TypeScriptコンパイラによる型チェック（エラーがないことを確認）
npx tsc --noEmit

# ESLintによるコード品質チェック
npm run lint
```

## 9. 移行計画

### フェーズ1: 検証（本テスト仕様書）

- [ ] ビルドプロセス削除後の動作確認
- [ ] すべてのコマンドが正常に動作することを確認

### フェーズ2: 本番適用（別仕様書で実施）

検証完了後、以下の手順で本番適用します。

1. `package.json` からビルドスクリプト削除
2. `dist/` ディレクトリ削除
3. `.gitignore` から `dist/` エントリ削除
4. ドキュメント更新
5. コミット・プッシュ

## 10. ロールバック計画

### ロールバック条件

- スラッシュコマンドが 1 つでも動作しない
- 同期プロセスが正常に機能しない
- 型チェックが失敗する

### ロールバック手順

1. Git コミットを 1 つ戻す: `git revert HEAD`
2. `npm run build`を再実行
3. `npm run sync:dogfood`で同期
4. 動作確認

## 11. 参考資料

- [CLAUDE.md](../CLAUDE.md) - プロジェクトガイドライン
- [package.json](../package.json) - NPM スクリプト定義
- [tsconfig.json](../tsconfig.json) - TypeScript 設定
