# 詳細設計とタスク分割フェーズの統合可否を検討し実装

**仕様書 ID:** dd4f5124-d3ca-4bd5-ab74-4aa8a761eb21
**フェーズ:** requirements
**作成日時:** 2025/11/25 19:01:52
**更新日時:** 2025/11/25 19:01:52

---

## 1. 背景と目的

### 背景

現在の cc-craft-kit は 5 フェーズモデル（requirements → design → tasks → implementation → completed）を採用しているが、以下の課題がある:

1. **design と tasks フェーズの分離による非効率**: 詳細設計を行う段階でタスク分割も同時に検討するのが自然な流れだが、現状は別フェーズとして分離されている
2. **タスク管理の不明確さ**: tasks テーブルは存在するが、仕様書ファイルとの同期フローが確立されていない
3. **セッション継続性の課題**: Claude Code のセッションを跨いで作業を継続する際、GitHub Issue に情報が集約されていないと作業状況の把握が困難
4. **並列作業の非効率**: 複数のタスクを並列で進める際の追跡手段が不足している

GitHub は 2024年10月に Sub Issue 機能（Public Preview）をリリースしており、親 Issue に最大 50 個の Sub Issue を紐付け、最大 8 階層のネストが可能。進捗は自動的に親 Issue に反映される。

### 目的

1. **フェーズの簡素化**: design と tasks フェーズを統合し、4 フェーズモデル（requirements → design → implementation → completed）に移行する
2. **GitHub Issue 中心の情報管理**: 仕様書の詳細情報と進捗を GitHub Issue に集約し、セッション間での情報共有を容易にする
3. **Sub Issue によるタスク管理**: 設計フェーズで生成されたタスクを Sub Issue として自動作成し、並列作業と進捗追跡を可能にする

---

## 2. 対象ユーザー

- cc-craft-kit を使用して仕様駆動開発（SDD）を行う開発者
- Claude Code を使用してセッションを跨いだ開発作業を行うユーザー
- GitHub Projects でプロジェクト管理を行うチーム

---

## 3. 受け入れ基準

### 必須要件

- [ ] design フェーズで詳細設計とタスク分割を同時に実行できる
- [ ] tasks フェーズを削除し、4 フェーズモデルに移行する
- [ ] design フェーズ完了時にタスクを Sub Issue として自動作成する
- [ ] 既存の仕様書（tasks フェーズ）を design フェーズにマイグレーションできる
- [ ] GitHub Issue 本文に仕様書の全内容を同期する

### 機能要件

- [ ] `/cft:spec-phase <id> design` 実行時に設計詳細セクションとタスクリストを生成する
- [ ] タスクリストの各項目を Sub Issue として自動作成する
- [ ] Sub Issue のステータス変更を親 Issue の進捗に反映する
- [ ] Sub Issue に作業メモ（進捗、エラー解決策、Tips）をコメントとして記録する
- [ ] `/cft:task-list <spec-id>` コマンドで Sub Issue の一覧と進捗を表示する
- [ ] `/cft:task-start <task-id>` コマンドで Sub Issue を「In Progress」に更新し作業を開始する
- [ ] `/cft:task-done <task-id>` コマンドで Sub Issue を「Done」に更新する

### 非機能要件

- [ ] フェーズ統合による既存データの破壊的変更を避ける（マイグレーションで対応）
- [ ] GitHub API 呼び出し回数を最小化する（バッチ処理、キャッシュ活用）
- [ ] Sub Issue 作成失敗時のリトライ機構を実装する

---

## 4. 制約条件

1. **GitHub Sub Issue の制限**
   - 親 Issue あたり最大 50 Sub Issue
   - 最大 8 階層のネスト
   - Public Preview 機能のため API 仕様変更の可能性あり

2. **後方互換性**
   - 既存の tasks フェーズにある仕様書は design フェーズに自動マイグレーション
   - tasks テーブルのデータは github_sync テーブルを通じて Sub Issue と紐付け

3. **技術的制約**
   - GitHub GraphQL API を使用（Sub Issue 操作に必要）
   - GITHUB_TOKEN に適切なスコープ（`repo`, `project`）が必要

---

## 5. 依存関係

### 内部依存

- `src/core/database/schema.ts`: SpecPhase 型定義の変更
- `src/core/workflow/github-integration.ts`: Sub Issue 作成・同期ロジック
- `src/core/workflow/phase-automation.ts`: design フェーズの自動処理拡張
- `.cc-craft-kit/slash-commands/spec-phase.md`: フェーズ遷移プロンプトの更新

### 外部依存

- GitHub Sub Issue API（GraphQL）
- GitHub Projects API（ステータス同期）

---

## 6. 参考情報

- [GitHub Sub Issues 公式ドキュメント](https://docs.github.com/en/issues/tracking-your-work-with-issues/using-issues/adding-sub-issues)
- [Evolving GitHub Issues (Public Preview)](https://github.blog/changelog/2025-01-13-evolving-github-issues-public-preview/)
- [Sub-issues: Enhancing issue management on GitHub](https://github.blog/engineering/architecture-optimization/introducing-sub-issues-enhancing-issue-management-on-github/)
- [GitHub Community Discussion #139932](https://github.com/orgs/community/discussions/139932)
