# GitHub Projects の status 再見直し

**仕様書 ID:** f0d9832e-e840-452b-a868-ce2fcedb5ea4
**フェーズ:** requirements
**作成日時:** 2025/12/03 00:00:00
**更新日時:** 2025/12/03 00:00:00

---

## 1. 背景と目的

### 背景

現在の cc-craft-kit では、仕様書のフェーズと GitHub Projects のステータスマッピングが以下の仕様に則っていない：

- **Todo**: タスク未開始 → `/cft:spec-create` 時
- **In Progress**: タスク作業中 → design フェーズおよび implementation フェーズ
- **In Review**: PR 作成済み、レビュー待ち → completed フェーズ時
- **Done**: タスク完了 → `/cft:pr-cleanup` 時

現行実装では `implementation → "In Review"` となっており、実装中なのにレビュー待ちと表示される不整合がある。また、`/cft:spec-phase <id> completed` と `/cft:pr-cleanup` コマンドの役割分担が不明確で、ステータス更新のタイミングが曖昧になっている。

### 目的

GitHub Projects のステータス管理を見直し、フェーズとステータスの対応関係を明確化する。`/cft:spec-phase` と `/cft:pr-cleanup` コマンドの役割を整理し、ユーザーにとって直感的なワークフローを実現する。

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] フェーズと GitHub Projects ステータスのマッピングが仕様通りに動作すること
- [ ] `/cft:spec-create` 実行時に GitHub Projects ステータスが「Todo」になること
- [ ] design/implementation フェーズで GitHub Projects ステータスが「In Progress」になること
- [ ] completed フェーズで GitHub Projects ステータスが「In Review」になること
- [ ] `/cft:pr-cleanup` 実行時に GitHub Projects ステータスが「Done」になること

### 機能要件

- [ ] `github-status-config.ts` のデフォルトマッピングを修正すること
- [ ] `/cft:spec-phase` と `/cft:pr-cleanup` の役割を明確に分離すること
- [ ] フェーズ遷移時のステータス更新ロジックを見直すこと
- [ ] 後方互換性を維持しながらマッピングを変更すること

### 非機能要件

- [ ] 既存の仕様書に影響を与えないこと（後方互換性）
- [ ] ドキュメント（README、ARCHITECTURE.md）を更新すること

---

## 4. 制約条件

- 既存の `config.json` によるカスタムマッピング機能は維持する
- `tasks` フェーズは非推奨だが後方互換性のためサポートを継続する
- GitHub Projects API のリトライ・検証ロジックは変更しない
- イベント駆動アーキテクチャ（EventBus）を維持する

---

## 5. 依存関係

### 関連ファイル

- `src/core/config/github-status-config.ts` - ステータスマッピング定義
- `src/integrations/github/phase-status-mapper.ts` - 動的マッパー実装
- `src/commands/spec/phase.ts` - `/cft:spec-phase` エントリポイント
- `src/commands/spec/update-phase.ts` - フェーズ更新ロジック
- `src/core/workflow/github-integration.ts` - GitHub 統合イベントハンドラー
- `src/integrations/github/projects.ts` - GitHub Projects API 実装
- `src/commands/github/pr-cleanup.ts` - PR マージ後処理

### 関連コンポーネント

- EventBus（`spec.phase_changed` イベント）
- DynamicStatusMapper（設定ベースのマッピング）
- GitHub Projects API

---

## 6. 参考情報

- 現行のステータスマッピング: `requirements → Todo`, `design → In Progress`, `implementation → In Review`, `completed → Done`
- 提案マッピング: `requirements → Todo`, `design → In Progress`, `implementation → In Progress`, `completed → In Review`, `pr-cleanup → Done`
