# /cft:spec-phase <id> design において詳細設計が自動で行われない

**仕様書 ID:** 2cfbe492-2629-4451-92ab-fbaf6ac1b77d
**フェーズ:** requirements
**作成日時:** 2025-01-25 10:30
**更新日時:** 2025-01-25 10:30

---

## 1. 背景と目的

### 背景

現在の `/cft:spec-phase <id> design` コマンドは、design フェーズへの遷移時に requirements フェーズのバリデーションのみを行い、詳細設計の自動実行を行っていない。

- `tasks` フェーズ移行時には、受け入れ基準から実装タスクリストを自動生成する機能がある
- `implementation` フェーズ移行時には、typescript-eslint スキルを自動実行する機能がある
- `completed` フェーズ移行時には、pr-creator スキルを自動実行する機能がある

一方、`design` フェーズ移行時には「その他のフェーズ」として扱われ、ガイダンスメッセージのみ表示されている状態。

### 目的

`/cft:spec-phase <id> design` コマンド実行時に、以下を自動実行する:

1. コードベース解析による関連コンポーネントの特定
2. アーキテクチャ設計の自動生成
3. 不明点のユーザーへの問い合わせ
4. 設計詳細セクション（## 7）の自動追加

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] design フェーズ移行時に、詳細設計の自動実行処理が呼び出されること
- [ ] 不明な点がある場合、AskUserQuestion ツールでユーザーに問い合わせること
- [ ] 自動生成された設計内容が仕様書の「## 7. 設計詳細」セクションに追記されること

### 機能要件

- [ ] Explore サブエージェントでコードベース解析を実行すること
- [ ] 解析結果に基づいてアーキテクチャ設計を生成すること
- [ ] 以下のサブセクションを含む「## 7. 設計詳細」を生成すること:
  - 7.1 アーキテクチャ設計
  - 7.2 実装方針
  - 7.3 テスト戦略

### 非機能要件

- [ ] 既存の spec-phase.md のプロンプト構造を維持すること
- [ ] 既存の他フェーズ（tasks, implementation, completed）の自動処理に影響しないこと

---

## 4. 制約条件

- プロンプトベース（.md）での実装を優先すること（CLAUDE.md のプロンプトファースト原則に準拠）
- 既存の spec-phase.md の Step 8「フェーズ固有の後処理」セクションを拡張すること
- 新規スクリプト（.ts）の追加は最小限に抑えること

---

## 5. 依存関係

- `src/slash-commands/spec-phase.md` - 修正対象
- `src/core/subagents/impl/architect-designer.ts` - 参考実装（活用可能）
- Explore サブエージェント - コードベース解析に使用
- AskUserQuestion ツール - ユーザーへの問い合わせに使用
- Edit ツール - 仕様書の設計セクション追記に使用

---

## 6. 参考情報

- 既存の tasks フェーズ後処理パターン（spec-phase.md Step 8）
- architect-designer サブエージェント実装（src/core/subagents/impl/architect-designer.ts）
