# spec-create したものがプロジェクトに反映されない

**仕様書 ID:** eb49a207-4c49-4392-a384-2fa1dd639440
**フェーズ:** completed
**作成日時:** 2025/11/16 16:26:14
**更新日時:** 2025/11/16 20:37:22

---

## 1. 背景と目的

### 背景

現在、`spec create` コマンドで仕様書を作成すると GitHub Issue は自動作成されるが、GitHub Projects のボードには自動追加されない。手動で `github project add` コマンドを実行する必要があり、ワークフローが分断されている。

### 目的

仕様書作成時に GitHub Issue を自動作成する際、環境変数 `GITHUB_PROJECT_NAME` または config.json の `project_id` が設定されている場合は、自動的に Projects ボードにも追加する。これにより、Issue 作成から Project 追加までのワークフローを完全自動化する。

---

## 2. 対象ユーザー

GitHub Projects v2 を使用してタスク管理を行っている cc-craft-kit ユーザー。特に仕様書作成から Project ボード管理までをシームレスに行いたいユーザー。

---

## 3. 受け入れ基準

### 必須要件

- [ ] 仕様書作成時に Issue が自動作成される（既存機能）
- [ ] `GITHUB_PROJECT_NAME` または `project_id` が設定されている場合、Issue を自動的に Project に追加
- [ ] Project 情報が未設定の場合は Issue 作成のみ行う（エラーにしない）
- [ ] Project 追加に失敗してもエラーメッセージを表示し、Issue 作成は成功させる

### 機能要件

- [ ] `resolveProjectId()` を再利用して Project 番号を取得
- [ ] Issue Node ID と Project ID を取得して `addProjectV2ItemById` mutation を実行
- [ ] Project 追加成功時にログ出力
- [ ] Project 追加失敗時に警告メッセージ表示

### 非機能要件

- [ ] Project 追加処理が失敗しても Issue 作成処理は成功する（部分的成功を許容）
- [ ] API 呼び出しは並列化せず、Issue 作成 → Project 追加の順で実行
- [ ] レスポンス時間は 5 秒以内

---

## 4. 制約条件

- GitHub API のレート制限（5000 リクエスト/時）
- Issue 作成と Project 追加は別の API 呼び出し（GraphQL mutation）
- 個人アカウントの Projects v2 は Classic PAT が必須
- Organization は Fine-grained PAT または Classic PAT

---

## 5. 依存関係

- `src/core/workflow/github-integration.ts` - Issue 自動作成イベントハンドラ
- `src/integrations/github/projects.ts` - Project 管理クラス
- `src/cli/commands/status.ts` - `resolveProjectId()` ロジック（再利用）
- 環境変数 `GITHUB_TOKEN`, `GITHUB_PROJECT_NAME`
- `.cc-craft-kit/config.json` - `project_id` フィールド

---

## 6. 参考情報

- 既存の Issue 自動作成実装: `src/core/workflow/github-integration.ts:registerGitHubIntegrationHandlers()`
- Project 追加コマンド: `src/cli/commands/github/project-add.ts`
- GitHub Projects v2 API: <https://docs.github.com/en/graphql/reference/mutations#addprojectv2itembyid>
