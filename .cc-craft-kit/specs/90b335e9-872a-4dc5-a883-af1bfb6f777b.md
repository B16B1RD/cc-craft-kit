# .env.example 中の MCP_PORT に関するサンプルは不要では？

**仕様書 ID:** 90b335e9-872a-4dc5-a883-af1bfb6f777b
**フェーズ:** implementation
**作成日時:** 2025/12/03 12:00:00
**更新日時:** 2025/12/03 16:39:46

---

## 1. 背景と目的

### 背景

cc-craft-kit は「MCP サーバー不要」をアーキテクチャの特徴として掲げているが、`.env.example` と `.env` に `MCP_PORT` の設定サンプルが残っている。コードベース解析の結果、`MCP_PORT` 環境変数を実際に使用している箇所は存在せず、MCP サーバーとして起動する機能も実装されていない。

また、`scripts/create-mcp-error-spec.ts` という MCP 起動エラー対応スクリプトも存在するが、これも不要である。

### 目的

実装されていない機能に関する設定サンプルやスクリプトを削除し、ユーザーの混乱を防ぐとともに、コードベースをクリーンに保つ。

---

## 2. 対象ユーザー

cc-craft-kit を使用する開発者（特に新規導入者）

---

## 3. 受け入れ基準

### 必須要件

- [ ] `.env.example` から MCP_PORT 関連のコメントとサンプルを削除
- [ ] `.env` から MCP_PORT 関連のコメントとサンプルを削除

### 機能要件

- [ ] `scripts/create-mcp-error-spec.ts` を削除
- [ ] 削除したファイルへの参照がある仕様書を更新

### 非機能要件

- [ ] 型チェック（`npm run typecheck`）がパスすること
- [ ] テスト（`npm test`）がパスすること

---

## 4. 制約条件

- プラグインシステム内の `MCPTool` 型定義は保持する（将来的な拡張可能性のため）
- `@modelcontextprotocol/sdk` 依存関係は保持する（プラグインが使用している可能性）
- Backlog/Slack プラグインの `getMCPTools()` メソッドは保持する

---

## 5. 依存関係

### 削除対象ファイル

| ファイル | 行番号 | 内容 |
|---|---|---|
| `.env.example` | 26-27 | MCP_PORT コメントとサンプル |
| `.env` | 26-27 | MCP_PORT コメントとサンプル |
| `scripts/create-mcp-error-spec.ts` | 全体 | MCP 起動エラー対応スクリプト |

### 参照元（更新が必要）

| ファイル | 参照内容 |
|---|---|
| `.cc-craft-kit/specs/4bd4f16b-a4fd-49d8-977c-9d3cb790ec21.md` | `create-mcp-error-spec.ts` への参照 |

---

## 6. 参考情報

- README.md: 「MCP サーバー不要でコンテキスト効率的なアーキテクチャを実現（MCP 比 99%削減）」
- docs/ARCHITECTURE.md: MCPTool 型の言及（保持）

---

## 7. 設計詳細

### 7.1 アーキテクチャ設計

#### 全体構成

本タスクは単純な削除作業であり、新規アーキテクチャの追加はありません。

```
削除対象:
├── .env.example (行26-27のみ削除)
├── .env (行26-27のみ削除)
└── scripts/create-mcp-error-spec.ts (ファイル全体を削除)

更新対象:
└── .cc-craft-kit/specs/4bd4f16b-*.md (参照箇所の削除)

保持対象（影響なし）:
├── src/core/plugins/types.ts (MCPTool型定義)
├── src/plugins/official/*/index.ts (getMCPTools()メソッド)
└── src/core/plugins/registry.ts (getAllMCPTools()メソッド)
```

#### 設計方針

- **最小限の変更**: 必要最小限のファイル変更に留める
- **型安全性の維持**: プラグインシステムのMCP関連型は保持
- **後方互換性**: プラグインの `getMCPTools()` メソッドは保持

#### 処理フロー詳細

1. 参照元仕様書を更新（循環参照を回避）
2. スクリプトファイルを `git rm` で削除
3. 環境変数設定ファイルからMCP_PORT行を削除
4. 型チェック・テストで検証

### 7.2 実装方針

#### 修正対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `.cc-craft-kit/specs/4bd4f16b-a4fd-49d8-977c-9d3cb790ec21.md` | `create-mcp-error-spec.ts` への参照を削除 |
| `scripts/create-mcp-error-spec.ts` | ファイル全体を `git rm` で削除 |
| `.env.example` | 行26-27（MCP_PORT コメント・サンプル）を削除 |
| `.env` | 行26-27（MCP_PORT コメント・サンプル）を削除 |

### 7.3 機能マッピング

| 機能 | 現在の実装 | 新しい実装 | 実装場所 |
|-----|----------|----------|---------|
| MCP_PORT 環境変数 | コメントアウトで存在 | 削除 | .env, .env.example |
| MCP起動エラー対応 | 自動仕様書作成スクリプト | 削除（手動対応へ） | scripts/ |
| MCPTool型定義 | 存在 | 保持（変更なし） | src/core/plugins/types.ts |

### 7.4 テスト戦略

| テスト対象 | テスト内容 | 検証方法 |
|----------|----------|---------|
| 型の整合性 | 削除後も型チェックがパス | `npm run typecheck` |
| テストスイート | 既存テストがすべてパス | `npm test` |
| コード品質 | Lintエラーなし | `npm run lint` |

### 7.5 移行計画

#### Phase 1: 参照更新

1. `.cc-craft-kit/specs/4bd4f16b-*.md` から `create-mcp-error-spec.ts` の参照を削除

#### Phase 2: ファイル削除

1. `scripts/create-mcp-error-spec.ts` を `git rm` で削除

#### Phase 3: 環境変数設定の更新

1. `.env.example` から MCP_PORT 行を削除
2. `.env` から MCP_PORT 行を削除

#### Phase 4: 検証

1. 型チェック（`npm run typecheck`）
2. テスト実行（`npm test`）
3. Lint チェック（`npm run lint`）

---

## 8. 実装タスクリスト

### Phase 1: 参照更新

- [x] 仕様書 4bd4f16b から `create-mcp-error-spec.ts` への参照を削除 (#584)

### Phase 2: ファイル削除

- [x] `scripts/create-mcp-error-spec.ts` を `git rm` で削除 (#585)

### Phase 3: 環境変数設定の更新

- [x] `.env.example` から MCP_PORT 関連行（26-27行目）を削除 (#586)
- [x] `.env` から MCP_PORT 関連行（26-27行目）を削除 (#587)

### Phase 4: 検証

- [x] 型チェック・テスト・Lintを実行して問題がないことを確認 (#588)
