# CI が失敗する PR が作成される

**仕様書 ID:** 2feaa5bf-2257-4c65-a4c0-0e770274a811
**フェーズ:** requirements
**作成日時:** 2025/12/04 12:00:00
**更新日時:** 2025/12/04 12:00:00

---

## 1. 背景と目的

### 背景

現在、cc-craft-kit では PR #738 で review フェーズ移行時の品質チェック（TypeScript 型チェック・ESLint）を導入済みだが、依然として CI が失敗する PR が作成されることがある。これは開発者の時間を無駄にし、レビュアーの負担を増加させる。CI が失敗しない PR を作成すべき。

### 目的

PR 作成前に CI で実行されるすべてのチェックをローカルで事前実行し、CI が失敗する PR の作成を防止する。

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] review フェーズ移行時に CI で実行されるすべてのチェックが事前実行される
- [ ] チェック失敗時は PR 作成をスキップし、具体的なエラー内容を表示する

### 機能要件

- [ ] TypeScript 型チェック（npm run typecheck）を実行する
- [ ] ESLint（npm run lint）を実行する
- [ ] テスト（npm test）を実行する（CI で実行される場合）
- [ ] チェック失敗時に修正ガイダンスを表示する

### 非機能要件

- [ ] 品質チェックの実行時間が 60 秒以内であること
- [ ] プロンプトファースト原則に従った実装であること

---

## 4. 制約条件

- プロンプトファースト原則: .md ファイルでロジック実装、TypeScript はスキル層のみ
- 既存の spec-phase.md の Step 4.5 の拡張として実装
- 既存スキル（typescript-eslint）を活用

---

## 5. 依存関係

- `src/slash-commands/spec-phase.md` - フェーズ遷移ロジック
- `src/skills/typescript-eslint/SKILL.md` - 品質チェックスキル
- `src/skills/pr-creator/SKILL.md` - PR 作成スキル
- `.github/workflows/` - CI ワークフロー定義

---

## 6. 参考情報

- PR #738: CI が失敗する PR が作成されることがある（既存の修正）
- 仕様書 ID: 987c1587 - 類似仕様書（マージ済み）
- `agent_docs/PROMPT_FIRST_PRINCIPLE.md` - プロンプトファースト原則
