# /cft:spec-delete コマンドの見直し

**仕様書 ID:** 1c541601-53b6-46fa-a900-d06b8a035fc7
**フェーズ:** requirements
**作成日時:** 2025-11-25 14:30
**更新日時:** 2025-11-25 14:30

---

## 1. 背景と目的

### 背景

現在、多くの部分がスクリプトで実現されていて、なかなか仕様通りに動作していない。プロンプト指示だと簡単にできることができていない。たいていの処理は、プロンプト指示の方が上手くいく。カスタムスラッシュコマンド→スキル→サブエージェントの構成が上手く実現できていない。改めて、Claude Code のカスタムスラッシュコマンド、スキル、サブエージェントの各機能の仕様についてよく考えて、スクリプトを使わずに仕様を実現できるか再設計して欲しい。スクリプトは最終手段です。ただし、スキル内のスクリプトは OK です。

### 目的

`/cft:spec-delete` コマンドを「プロンプトファースト原則」に従って再設計する。現在スクリプト側に集中している UI 処理・結果表示・エラー解析をプロンプト側に移行し、スクリプトは DB 操作・GitHub API・イベント発火など必須処理のみに限定する。

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発（SDD）を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] プロンプト側で削除対象の情報表示・確認フローを制御できる
- [ ] スクリプトは DB 操作・GitHub API・イベント発火のみに限定される
- [ ] `/cft:spec-phase` や `/cft:spec-create` と同様の設計パターンに統一される

### 機能要件

- [ ] 仕様書 ID の部分一致検索（最小 8 文字）に対応
- [ ] `--yes` オプションで確認プロンプトをスキップ可能
- [ ] `--close-github-issue` オプションで GitHub Issue を自動クローズ（デフォルト有効）
- [ ] 削除前に対象情報（ID、名前、フェーズ、GitHub Issue 番号）を表示
- [ ] 削除後に成功メッセージと次のアクションを提示
- [ ] エラー時に原因と復旧手順を表示

### 非機能要件

- [ ] スラッシュコマンド（.md）がメインの制御フローを担当
- [ ] スクリプト（.ts）は JSON 出力のみで UI 処理を含まない
- [ ] CLAUDE.md の「プロンプトファースト原則」に準拠

---

## 4. 制約条件

- スクリプト実装が必須な処理:
  - データベース操作（Kysely によるトランザクション管理）
  - GitHub API 呼び出し（Octokit の認証・レート制限管理）
  - イベント発火（EventBus の初期化・ハンドラー登録）
- プロンプト側で実装すべき処理:
  - 削除前の情報表示
  - 確認プロンプト（`--yes` オプション処理）
  - 結果表示・エラー解析
  - ガイダンスメッセージ

---

## 5. 依存関係

- `src/commands/spec/resolve-id.ts` - 仕様書 ID 解決スクリプト
- `src/commands/spec/delete.ts` - 削除実行スクリプト（要リファクタリング）
- `src/core/database/connection.ts` - データベース接続
- `src/integrations/github/issues.ts` - GitHub Issue 操作
- `src/core/workflow/event-bus.ts` - イベントバス

---

## 6. 参考情報

- `/cft:spec-phase` 実装: `src/slash-commands/spec-phase.md`（プロンプトベース成功例）
- `/cft:spec-create` 実装: `src/slash-commands/spec-create.md`（プロンプトベース成功例）
- CLAUDE.md「プロンプトファースト原則」セクション
- 現在の実装: `src/slash-commands/spec-delete.md`, `src/commands/spec/delete.ts`
