---
id: "ceaa898d-6e16-4775-b71d-6e2b28b0de38"
name: "GitHub 統合機能の見直し"
phase: "completed"
branch_name: "main"
github_issue_number: null
pr_url: null
created_at: "2025-11-16T14:41:29Z"
updated_at: "2025-11-16T20:37:46Z"
---

# GitHub 統合機能の見直し


## 1. 背景と目的

### 背景

GitHub 統合機能が機能していない。Issue が自動作成されないことは確認済み。

### 目的

GitHub Issue の自動作成機能を実装し、仕様駆動開発のワークフローを完全自動化する。
---

## 2. 調査結果

### 現状の問題点

コードベースを調査した結果、以下の問題が判明しました:

#### 1. Issue 自動作成の仕組みが未実装

- `src/cli/commands/spec/create.ts` (L87-L163)
  - 仕様書作成後に `spec.created` イベントを発行していない
  - イベント駆動アーキテクチャが活用されていない

#### 2. StoryToDonePipeline が使われていない

- `src/core/workflow/pipeline.ts` (L11-L164)
  - `StoryToDonePipeline` クラスが定義されているが、どこからも呼び出されていない
  - `spec.created` イベントのハンドラーは実装されているが、GitHub Issue 作成は含まれていない

#### 3. GitHub Issue 作成は手動コマンドのみ

- `src/cli/commands/github/issue-create.ts` (L41-L176)
  - `takumi github issue create <spec-id>` コマンドを手動で実行する必要がある
  - 自動作成の実装がそもそも存在しない

### 現在の動作フロー

```text
1. takumi spec create <name>
   ↓
2. データベースに保存
   ↓
3. Markdown ファイル生成
   ↓
4. 完了（イベント未発行）

※ Issue 作成には別途手動で以下を実行:
  takumi github issue create <spec-id>
```

### 期待される動作フロー（未実装）

```text
1. takumi spec create <name>
   ↓
2. データベースに保存
   ↓
3. spec.created イベント発行
   ↓
4. イベントハンドラー起動
   ↓
5. GitHub Issue 自動作成
```
---

## 3. 受け入れ基準

### 必須要件

- [ ] 仕様書作成時に自動的に GitHub Issue が作成される
- [ ] GitHub 統合が未設定の場合はスキップされる（エラーにならない）
- [ ] 既存の手動コマンドも引き続き動作する

### 機能要件

- [ ] `spec.created` イベントが仕様書作成時に発行される
- [ ] イベントハンドラーが GitHub Issue を自動作成する
- [ ] Issue 作成失敗時も仕様書作成は成功する（ログに警告）
- [ ] Issue 番号がデータベースに記録される

### 非機能要件

- [ ] GitHub API のレート制限を考慮する
- [ ] 既存のテストが全てパスする
- [ ] パフォーマンスへの影響が最小限である
---

## 4. 制約条件

- GitHub API v3 (REST API) を使用
- GITHUB_TOKEN 環境変数が必須
- Fine-grained Personal Access Token が必要（Issues: Read/Write）
---

## 5. 依存関係

### 既存実装

- `src/core/workflow/event-bus.ts` - イベントバス（実装済み）
- `src/integrations/github/issues.ts` - GitHub Issues API ラッパー（実装済み）
- `src/cli/commands/spec/create.ts` - 仕様書作成コマンド（要修正）

### 新規実装が必要

- イベントハンドラーの登録ロジック
- GitHub 統合チェック機能
- エラーハンドリング
---

## 6. 参考情報

### 関連ファイル

- `src/core/workflow/pipeline.ts:26` - `spec.created` イベントハンドラーの例
- `src/cli/commands/github/issue-create.ts` - 手動 Issue 作成の実装
- `src/core/workflow/event-bus.ts:8` - `spec.created` イベント定義
- `CLAUDE.md:154-168` - イベント駆動アーキテクチャの説明
