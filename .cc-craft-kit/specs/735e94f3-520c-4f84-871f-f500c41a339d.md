# インストールで失敗する

**仕様書 ID:** 735e94f3-520c-4f84-871f-f500c41a339d
**フェーズ:** requirements
**作成日時:** 2025/12/04 22:45:00
**更新日時:** 2025/12/04 22:45:00

---

## 1. 背景と目的

### 背景

以下のようにインストールで失敗します。
$ curl -fsSL https://raw.githubusercontent.com/B16B1RD/cc-craft-kit/main/scripts/install.sh | sh
cc-craft-kit のインストールを開始します...

環境をチェックしています...
✓ 環境チェック完了
GitHub Releases から最新バージョンを取得しています...
✓ 最新バージョン: v0.1.7
アーカイブを . に展開しています...
tar (child): \033[0;34mcc-craft-kit v0.1.7 をダウンロードしています...\033[0m\n\033[0;32m✓ ダウンロード完了\033[0m\n/tmp/tmp.Q2CfYwEHCB: open 不能: そのようなファイルやディレクトリはありません
tar (child): Error is not recoverable: exiting now
tar: Child returned status 2
tar: Error is not recoverable: exiting now
エラー: アーカイブの展開に失敗しました。

### 目的

install.sh スクリプトのバグを修正し、`curl | sh` でのパイプ実行時に正常にインストールが完了するようにする。

---

## 2. 対象ユーザー

cc-craft-kit を新規インストールするユーザー

---

## 3. 受け入れ基準

### 必須要件

- [ ] `curl -fsSL ... | sh` でインストールが正常に完了すること
- [ ] tar 展開時に ANSI エスケープシーケンスがファイル名として解釈されないこと

### 機能要件

- [ ] `download_archive()` 関数が正しいファイルパスのみを返すこと
- [ ] ログ出力（info, success, error）は stderr に出力されること
- [ ] パイプ経由での実行時もカラー表示が正常に動作すること

### 非機能要件

- [ ] 対話的実行（直接実行）時の動作が変更されないこと
- [ ] エラーメッセージが分かりやすいこと

---

## 4. 制約条件

- POSIX sh 互換を維持すること
- 既存のインストールフローを大幅に変更しないこと
- bash, zsh, sh などの主要シェルで動作すること

---

## 5. 依存関係

- `scripts/install.sh` - メインのインストールスクリプト
- 前回の修正 PR #619（アーカイブ構造問題）との整合性

---

## 6. 参考情報

- 関連仕様書: `7771d1e1-fea7-4631-b4b9-3a5fa07e4fbc`（インストーラーでエラー - completed）
- 問題の原因: `download_archive()` 関数内の `info()` 出力が stdout にも出力され、関数の戻り値キャプチャ時に ANSI エスケープシーケンスが混入している
