---
id: "d2cd71bd-78d6-4603-ac86-af73dd79aadc"
name: "/cft:spec create で、GitHub Issue が作成されない"
phase: "completed"
branch_name: "fix/spec-d2cd71bd-github-issue-not-created"
github_issue_number: 957
created_at: "2025-12-06T12:00:00+09:00"
updated_at: "2025-12-06T23:45:00+09:00"
---

# /cft:spec create で、GitHub Issue が作成されない

## 1. 背景と目的

### 背景

`/cft:spec create` コマンドで仕様書を作成する際、GitHub Issue が自動作成されることが期待されるが、現在の実装では Issue が作成されていない。

### 目的

`/cft:spec create` コマンド実行時に、GitHub Issue を自動作成し、仕様書と Issue を連携させる。

---

## 2. 対象ユーザー

- cc-craft-kit を使用して仕様駆動開発を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] `/cft:spec create` 実行時に GitHub Issue が自動作成される
- [ ] 作成された Issue 番号が仕様書の `github_issue_number` フィールドに記録される

### 機能要件

- [ ] Issue タイトルは仕様書名をそのまま使用
- [ ] Issue 本文には仕様書（要求仕様書）と同じ内容を掲載
- [ ] GitHub Projects への自動追加（config.json に設定がある場合）

### 非機能要件

- [ ] gh CLI がインストールされていない場合は警告を表示して続行
- [ ] Issue 作成に失敗した場合も仕様書作成は成功扱い

---

## 4. 制約条件

- gh CLI がインストールされ、認証済みであること
- GitHub リポジトリが設定されていること

---

## 5. 依存関係

- `/cft:spec create` コマンド（.claude/commands/cft/spec.md）
- gh CLI

---

## 6. 参考情報

- 現在の `/cft:spec create` フローには GitHub Issue 作成ステップが含まれていない（Step 8 の後に追加が必要）
- `/cft:github issue` コマンドで手動作成は可能
- design フェーズでは Sub Issue 作成と GitHub Projects 追加が実装済み

---

## 7. 設計詳細

### 7.1 問題の根本原因

`.claude/commands/cft/spec.md` の `create` サブコマンドのフローに GitHub Issue 作成ステップが存在しない。

現在のフロー:
1. UUID 生成
2. ブランチ名生成
3. ベースブランチ取得
4. ブランチ作成・切り替え
5. 仕様書ファイル作成
6. コードベース解析（オプション）
7. 仕様書の自動補完
8. 自動コミット
9. 元ブランチに復帰
10. 成功メッセージ

**不足**: Step 8 と Step 9 の間に GitHub Issue 作成ステップがない。

### 7.2 解決アプローチ

Step 8 の後に新しいステップ「Step 9: GitHub Issue 作成」を追加する。

**追加内容:**

```markdown
#### Step 9: GitHub Issue 作成（オプション）

gh CLI が利用可能な場合、GitHub Issue を自動作成:

1. **gh CLI チェック:**
   ```bash
   command -v gh >/dev/null 2>&1
   ```
   失敗した場合は警告を表示して続行。

2. **Issue 作成:**
   ```bash
   gh issue create --title "$SPEC_NAME" --body "$ISSUE_BODY"
   ```

   `$ISSUE_BODY` の内容:
   仕様書（要求仕様書）の YAML フロントマター以降の本文をそのまま使用。

3. **Issue 番号を仕様書に記録:**
   Edit ツールで仕様書の YAML フロントマターを更新:
   ```
   github_issue_number: null → github_issue_number: <作成された Issue 番号>
   ```

4. **追加コミット:**
   ```bash
   git add ".cc-craft-kit/specs/$SPEC_ID.md"
   git commit --amend --no-edit
   ```

5. **GitHub Projects に追加**（config.json に設定がある場合）:
   design フェーズと同様の処理を実行。
```

### 7.3 影響範囲

- `.claude/commands/cft/spec.md` の `create` サブコマンドセクション

### 7.4 成功メッセージの更新

```
✓ 仕様書を作成しました

仕様書 ID: $SPEC_ID
名前: $2
フェーズ: requirements
ファイル: .cc-craft-kit/specs/$SPEC_ID.md
ブランチ: $BRANCH_NAME
GitHub Issue: #$GITHUB_ISSUE_NUMBER  ← 追加

次のステップ:
- 仕様書を確認: /cft:spec get <短縮ID>
- 設計フェーズへ: /cft:spec phase <短縮ID> design
```

---

## 8. 実装タスクリスト

- [ ] Step 9 として GitHub Issue 作成ステップを追加
- [ ] Step 10 として元ブランチに復帰（旧 Step 9）を更新
- [ ] 成功メッセージに GitHub Issue 番号を追加
- [ ] 次のステップから `/cft:github issue` の案内を削除
