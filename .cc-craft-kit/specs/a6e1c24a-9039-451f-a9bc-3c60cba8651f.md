# 開発キット開発時の設計および実装のルール CLAUDE.md に適切に追記

**仕様書 ID:** a6e1c24a-9039-451f-a9bc-3c60cba8651f
**フェーズ:** requirements
**作成日時:** 2025/11/24 08:30:51
**更新日時:** 2025/11/24 08:30:51

---

## 1. 背景と目的

### 背景

開発キットの開発においては、以下のルールを徹底したい。CLUADE.md に効果的な表現で追記したい。
設計・実装においては、以下の点に十分気を付けて欲しい。
- プロンプトファースト：プロンプトで実現できることはプロンプトで実現すること
- スキルで実現できないか、サブエージェントで実現できないかよく考えること
- スクリプトによる実現は、最終手段です

### 目的

CLAUDE.md に開発キット開発時の設計・実装指針を追記し、以下を明確化する：

1. **プロンプトファースト原則の徹底**: プロンプト (.md) で実現可能な機能は、スクリプト (.ts) ではなくプロンプトで実装する
2. **スキル・サブエージェント活用の推奨**: Task ツール、Skill ツールを活用し、複雑な処理をサブエージェントに委譲する
3. **スクリプト実装の最小化**: TypeScript スクリプトは、データベース操作、GitHub API、イベント駆動処理など、プロンプトで実現不可能な処理に限定する

これにより、開発者が適切な実装方法を選択できるようにし、保守性・拡張性の高いコードベースを維持する。

---

## 2. 対象ユーザー

**対象**: cc-craft-kit の開発者（コントリビューター、メンテナー）

**役割**:
- 新機能の設計・実装
- 既存機能のリファクタリング
- バグ修正
- ドキュメント整備

**前提知識**:
- TypeScript の基礎知識
- Claude Code の仕組み（プロンプト、スキル、サブエージェント）
- cc-craft-kit のアーキテクチャ（モジュラーモノリス、イベント駆動）

---

## 3. 受け入れ基準

### 必須要件

- [ ] CLAUDE.md に「設計・実装の判断基準」セクションを追加
- [ ] プロンプトファースト原則を明確に記述
- [ ] スキル・サブエージェント活用の推奨を明記
- [ ] スクリプト実装が必要な処理の具体例を列挙
- [ ] プロンプトベース実装の具体例を列挙

### 機能要件

- [ ] 既存セクション「スクリプトとプロンプトの使い分け指針」を拡張
- [ ] 判断基準チェックリストを強化（プロンプトファースト視点を追加）
- [ ] 実装パターンの参照ファイルを明記（例: `src/slash-commands/code-review.md`）
- [ ] 設計フロー図を追加（プロンプト → スキル → スクリプトの順）

### 非機能要件

- [ ] 既存 CLAUDE.md の記述スタイルと統一
- [ ] 開発者が迷わずに実装方法を選択できる明確さ
- [ ] 実装例は実際のコードベースから抽出（架空の例は使用しない）
- [ ] 参考ファイルへのパスは絶対パスで記載

---

## 4. 制約条件

### 技術的制約

- **既存セクション構造の維持**: CLAUDE.md の既存セクション順序を保持する
- **Markdown 形式**: 見出しレベル、リスト形式、コードブロックを既存スタイルに合わせる
- **ファイルパス表記**: プロジェクトルートからの相対パス（例: `src/commands/spec/create.ts`）

### 設計制約

- **既存セクション「スクリプトとプロンプトの使い分け指針」との整合性**: 重複を避け、補完する内容にする
- **プロンプトファースト原則**: Claude Code の基本思想に従う
- **実装例の正確性**: 実際のコードベースに存在するファイル・関数名のみを記載

### 運用上の制約

- **開発者の学習コスト**: 新規開発者が 30 分以内に理解できる記述量
- **保守性**: CLAUDE.md の更新頻度を考慮し、アーキテクチャ変更に強い記述にする

---

## 5. 依存関係

### 既存仕様書

- なし（CLAUDE.md の更新のみのため、他の仕様書への依存なし）

### 既存コンポーネント

**参照するファイル**:
- `CLAUDE.md` - 更新対象ファイル
- `src/slash-commands/**/*.md` - プロンプトベース実装の例
- `src/commands/**/*.ts` - スクリプト実装の例
- `src/core/workflow/event-bus.ts` - イベント駆動実装の例

**参照する実装パターン**:
- プロンプトベース: `src/slash-commands/code-review.md`, `test-generate.md`, `refactor.md`
- スクリプト実装: `src/commands/spec/create.ts`, `github/issue-create.ts`

---

## 6. 参考情報

### 公式ドキュメント

- [ARCHITECTURE.md](./docs/ARCHITECTURE.md) - アーキテクチャ設計の詳細
- [QUICK_START.md](./docs/QUICK_START.md) - 開発環境セットアップ

### 既存の実装例

**プロンプトベース実装:**
- `src/slash-commands/spec-phase.md` - フェーズ遷移（バリデーション、自動処理）
- `src/slash-commands/code-review.md` - code-reviewer サブエージェント起動
- `src/slash-commands/test-generate.md` - test-generator サブエージェント起動
- `src/slash-commands/refactor.md` - refactoring-assistant サブエージェント起動

**スクリプト実装:**
- `src/commands/spec/create.ts` - 仕様書作成（DB操作、イベント発火）
- `src/commands/spec/phase.ts` - フェーズ更新（DB操作、Git統合）
- `src/commands/github/issue-create.ts` - GitHub Issue 作成（Octokit 認証、API呼び出し）
- `src/commands/sync/check.ts` - 整合性チェック（複雑なバリデーション）

### 技術スタック

- **プロンプトベース**: Markdown, Claude Code ツール（Task, Skill, Read, Write, Edit, Glob, Grep, Bash）
- **スクリプト**: TypeScript, Kysely, EventEmitter2, Octokit, Zod
