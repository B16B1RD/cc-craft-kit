# TDD の見直し

**仕様書 ID:** ea8aadc5-4750-4995-a2d7-4304eb786b8f
**フェーズ:** requirements
**作成日時:** 2025/11/28 00:00:00
**更新日時:** 2025/11/28 00:00:00

---

## 1. 背景と目的

### 背景

https://gihyo.jp/article/2024/01/automated-test-and-tdd を注意深く読み、真の TDD を理解し、本開発キットの TDD がこれに沿ったものとなっているかチェックし、設計と実装を見直してほしい。

### 目的

参考記事が示す「真の TDD」の原則に基づき、本開発キットの TDD 実践状況を評価・改善する。特に以下の観点で見直しを行う：

1. **TDD の本質理解**: テストファーストだけでなく、Red-Green-Refactor サイクルによる設計改善
2. **カバレッジ目標の適正化**: 現状 33% → 80% への段階的引き上げ
3. **テスト生成機能の高度化**: ボイラープレート生成から実装解析ベースへ進化
4. **ドキュメントの統一**: TDD_GUIDE.md の Jest 対応・SDD スタイルへの更新

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発（SDD）を行う開発者、および TDD を実践したい開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] 参考記事の TDD 原則（Red-Green-Refactor、テストファースト≠TDD の区別）が理解され、文書化される
- [ ] 現在のテスト戦略が参考記事の原則に照らして評価され、ギャップが特定される

### 機能要件

- [ ] jest.config.js のカバレッジ閾値を段階的に引き上げる計画を策定する（33% → 50% → 70% → 80%）
- [ ] TDD_GUIDE.md を Jest 対応・SDD スタイルに更新する
- [ ] `/cft:test-generate` コマンドを実装解析ベースのテスト生成に高度化する
- [ ] テスト除外ファイル（testPathIgnorePatterns）を削減する方針を策定する

### 非機能要件

- [ ] テストの保守性が向上し、モックパターンが統一される
- [ ] 記事が警告する「100% カバレッジの追求」を避け、無駄なく漏れのないテスト設計を目指す

---

## 4. 制約条件

- 既存のテストスイート（934 テストケース）を破壊しない
- Jest v29.7.0 を継続使用（Vitest への移行は別仕様で検討）
- CLAUDE.md のプロンプトファースト原則に従い、テスト生成はプロンプトベースを優先
- 記事の警告に従い、過度な先行設計（スコープクリープ）を避ける

---

## 5. 依存関係

- `jest.config.js` - テスト設定（カバレッジ閾値）
- `docs/TDD_GUIDE.md` - TDD 実践ガイド（更新対象）
- `src/slash-commands/test-generate.md` - テスト生成コマンド定義
- `src/core/subagents/impl/test-creator.ts` - テスト生成サブエージェント実装
- `tests/` - テストスイート全体

---

## 6. 参考情報

### 参考記事の要点

- **TDD の本質**: 単なるテスト手法ではなく、プログラミング中の不安をコントロールする手法
- **テストファースト ≠ TDD**: テストファーストは試験性を高めるが、TDD はリファクタリングを含む
- **Red-Green-Refactor**: 各ステップで焦点を分離し、「動作するきれいなコード」を達成
- **警告**: 100% カバレッジ追求は「手段の目的化」、過度な先行設計は「スコープクリープ」

### 現状評価

| 項目 | 現状 | 課題 |
|------|------|------|
| カバレッジ閾値 | 33% | 目標 80% との乖離 |
| テスト成功率 | 97.6% | 良好 |
| テスト除外 | 9 パターン | import.meta 問題など |
| ドキュメント | Vitest 記載 | Jest に更新必要 |

### 参考リンク

- https://gihyo.jp/article/2024/01/automated-test-and-tdd
