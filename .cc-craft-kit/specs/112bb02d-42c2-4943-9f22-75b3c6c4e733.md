# /cft:spec-create をどのブランチにいても中断することなく実行できるようにする

**仕様書 ID:** 112bb02d-42c2-4943-9f22-75b3c6c4e733
**フェーズ:** requirements
**作成日時:** 2025/12/01 12:00:00
**更新日時:** 2025/12/01 12:00:00

---

## 1. 背景と目的

### 背景

現在の `/cft:spec-create` コマンドは、Step 4.6「実行元ブランチの確認と警告」において、ベースブランチ（通常は `develop`）以外のブランチから実行した場合、`AskUserQuestion` ツールでユーザーに確認を求める。ユーザーが「中断」を選択すると、処理が完全に停止し、手動でベースブランチに切り替えてから再実行する必要がある。

この設計は、作業ブランチがベースブランチから正しく派生することを保証するための安全策だが、以下の問題がある：

- CI/CD パイプラインやスクリプトからの自動実行が困難
- 別の仕様書で作業中に新しい仕様書を作成する際、毎回ブランチ切り替えが必要
- 元のブランチに自動復帰するため、実質的に「中断」の必要性が低い

### 目的

`/cft:spec-create` コマンドを、どのブランチからでも中断することなく実行できるようにする。警告メッセージは維持しつつ、ユーザー確認（`AskUserQuestion`）を廃止し、処理を自動続行する。最終的に Step 10 で元のブランチに復帰するため、ユーザーの作業状態は保持される。

---

## 2. 対象ユーザー

cc-craft-kit を使用する開発者。特に以下のユースケースを持つ開発者：

- 別の仕様書で作業中に、新しいアイデアや課題を仕様書として記録したい
- CI/CD パイプラインから仕様書を自動作成したい
- 作業フローを中断せずに仕様書を作成したい

---

## 3. 受け入れ基準

### 必須要件

- [ ] ベースブランチ以外から `/cft:spec-create` を実行しても、処理が中断しないこと
- [ ] 処理完了後、元のブランチ（`ORIGINAL_BRANCH`）に自動復帰すること
- [ ] 新規作成された仕様書ブランチは、常にベースブランチ（`BASE_BRANCH`）から派生すること

### 機能要件

- [ ] ベースブランチ以外からの実行時、警告メッセージを表示すること（情報提供のみ）
- [ ] `AskUserQuestion` によるユーザー確認を廃止すること
- [ ] 警告後、自動的に Step 5 へ進むこと
- [ ] Step 10 で確実に元ブランチに復帰すること

### 非機能要件

- [ ] 処理全体の実行時間に大きな影響を与えないこと
- [ ] 既存のテストケースが引き続きパスすること
- [ ] ドキュメント（エラーハンドリングまとめ）が更新されていること

---

## 4. 制約条件

- **プロンプトファースト原則**: 本修正はプロンプト（`.md`ファイル）のみで実現可能。スクリプト（`.ts`）の変更は不要。
- **変更対象ファイル**: `src/slash-commands/spec-create.md` の Step 4.6 セクションのみ
- **Git ブランチ**: 新規仕様書ブランチは常に `BASE_BRANCH` から派生する（現行動作を維持）
- **警告メッセージ**: 廃止ではなく、ユーザー確認を廃止。情報提供としての警告は維持。

---

## 5. 依存関係

### 関連ファイル

| ファイル | 役割 | 修正必要 |
|---------|------|---------|
| `src/slash-commands/spec-create.md` | `/cft:spec-create` コマンド定義 | ✓ 要修正 |
| `.cc-craft-kit/slash-commands/spec-create.md` | 自動生成版（同期管理） | 自動同期 |
| `tests/slash-commands/spec-create.test.ts` | テストケース | 確認必要 |

### 関連コンポーネント

- `src/core/git/branch-cache.ts`: 現在のブランチ名取得
- `src/commands/spec/register.ts`: DB 登録処理

---

## 6. 参考情報

- [Step 4.6 の現在実装](src/slash-commands/spec-create.md) - Line 109-158
- コミット `e4af508`: 実行元ブランチ警告・自動コミット追加
- 類似実装: `src/slash-commands/session-start.md`（セッション管理パターン）
