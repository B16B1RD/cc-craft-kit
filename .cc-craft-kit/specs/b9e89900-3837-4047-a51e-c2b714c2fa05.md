# GITHUB_DEFAULT_BASE_BRANCH を BASE_BRANCH へ変更

**仕様書 ID:** b9e89900-3837-4047-a51e-c2b714c2fa05
**フェーズ:** requirements
**作成日時:** 2025/11/24 14:38:11
**更新日時:** 2025/11/24 14:38:11

---

## 1. 背景と目的

### 背景

現在、cc-craft-kit では PR 作成時のマージ先ブランチを指定する環境変数が `GITHUB_DEFAULT_BASE_BRANCH` として定義されています。しかし、この命名には以下の問題があります:

1. **命名規則の不統一**: `GITHUB_*` プレフィックスは GitHub API や GitHub 固有の設定に使用されるべきですが、`GITHUB_DEFAULT_BASE_BRANCH` は Git ブランチ管理の基本設定であり、GitHub API には直接関係していません。
2. **冗長な命名**: 「DEFAULT」が含まれているため、他のベースブランチが存在するかのような誤解を招く可能性があります。
3. **設計意図の不明瞭さ**: 仕様駆動開発では「すべての仕様書ブランチは同じベースブランチから派生し、同じベースブランチにマージされるべき」という設計思想がありますが、現在の命名では意図が伝わりにくくなっています。

既存の仕様書（b1098fbd-2d4c-464d-8831-7cebc42c1f0d）では、この問題が指摘され、`BASE_BRANCH` へのリネームが提案されています。

### 目的

環境変数 `GITHUB_DEFAULT_BASE_BRANCH` を `BASE_BRANCH` にリネームし、以下を達成します:

1. **命名規則の統一**: `PROTECTED_BRANCHES` などの Git ブランチ管理設定と一貫性のある命名に変更
2. **設計意図の明確化**: ベースブランチは1つであり、すべての仕様書ブランチがこのブランチから派生・マージされることを命名で表現
3. **コードの可読性向上**: 環境変数名と設定の役割が直感的に理解できるようにする

---

## 2. 対象ユーザー

- **cc-craft-kit を使用する開発者**: 環境変数 `.env` ファイルを設定してツールキットを使用するすべての開発者
- **cc-craft-kit の保守担当者**: 環境変数の命名規則を統一し、コードの可読性・保守性を向上させたい開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] 環境変数 `GITHUB_DEFAULT_BASE_BRANCH` が `BASE_BRANCH` にリネームされていること
- [ ] `.env.example` ファイルで `BASE_BRANCH` が定義され、適切なコメントが付いていること
- [ ] すべての使用箇所（`src/core/config/github-config.ts` など）で `BASE_BRANCH` を参照していること
- [ ] `GitHubConfig` インターフェースの `defaultBaseBranch` プロパティが `BASE_BRANCH` から読み込まれていること
- [ ] すべての既存機能（PR 作成、ブランチ管理）が正常に動作すること

### 機能要件

- [ ] 環境変数の読み込み処理で `trim()` が適用されていること
- [ ] デフォルト値 `'develop'` が維持されていること
- [ ] hotfix ブランチの特殊処理（`main` へのPR作成）が維持されていること
- [ ] `process.env.BASE_BRANCH` が未定義の場合に `'develop'` が使用されること

### 非機能要件

- [ ] 単体テスト（`tests/core/config/github-config.test.ts` など）が `BASE_BRANCH` を使用するように更新され、すべてパスすること
- [ ] 型チェック（`npx tsc --noEmit`）がエラーなく完了すること
- [ ] ESLint チェック（`npm run lint`）がエラーなく完了すること
- [ ] 環境変数の命名規則が `PROTECTED_BRANCHES` などの既存設定と統一されていること

---

## 4. 制約条件

### 技術的制約

1. **環境変数の読み込みタイミング**: `src/core/config/env.ts` で `dotenv` が設定されており、すべてのコマンドファイルの先頭でインポートされること
2. **型安全性**: `GitHubConfig` インターフェースの `defaultBaseBranch` プロパティは `string` 型であること
3. **デフォルト値の維持**: 既存の動作を維持するため、デフォルト値は `'develop'` とすること
4. **後方互換性**: 既存の `.env` ファイルを使用している開発者向けに、移行手順を明示すること

### 影響範囲

1. **コア設定モジュール**: `src/core/config/github-config.ts`
2. **GitHub 統合モジュール**: `src/integrations/github/pull-request.ts`
3. **ワークフロー処理**: `src/core/workflow/branch-management.ts`
4. **ブランチ操作**: `src/core/git/branch-creation.ts`, `src/commands/spec/create.ts`
5. **単体テスト**: `tests/core/config/github-config.test.ts`, `tests/core/workflow/branch-management-pr-creation.test.ts`

### 運用上の制約

1. **既存の開発者への影響**: `.env` ファイルを使用している開発者は環境変数名を変更する必要がある
2. **ドキュメント更新**: README.md、QUICK_START.md などのドキュメントで環境変数名を更新すること

---

## 5. 依存関係

### 関連仕様書

- **b1098fbd-2d4c-464d-8831-7cebc42c1f0d** (completed): `.env の GITHUB_DEFAULT_BASE_BRANCH は不要では？`
  - この仕様書で `BASE_BRANCH` へのリネームが提案されている

### 依存モジュール

1. **環境変数読み込み**: `dotenv` (v16.4.7)
   - `src/core/config/env.ts` で設定され、`process.env` から環境変数を読み込む
2. **Git 操作**: `simple-git` (v3.27.0)
   - ブランチ作成、PR 作成時のベースブランチ決定に使用
3. **GitHub API**: `@octokit/rest` (v21.0.2)
   - PR 作成時にベースブランチを指定
4. **型定義**: TypeScript (v5.7.3)
   - `GitHubConfig` インターフェースで `defaultBaseBranch` を定義

### 影響を受けるコンポーネント

1. **仕様書ブランチ作成**: `src/core/git/branch-creation.ts`
   - 保護ブランチから仕様書ブランチを作成する際にベースブランチを参照
2. **PR 作成**: `src/integrations/github/pull-request.ts`
   - PR 作成時のマージ先ブランチを決定
3. **イベント駆動処理**: `src/core/workflow/branch-management.ts`
   - `spec.phase_changed` イベント（implementation → completed）での PR 自動作成

---

## 6. 参考情報

### ソースコード参照

- **環境変数定義**: `src/core/config/github-config.ts:33`
  - 現在: `process.env.GITHUB_DEFAULT_BASE_BRANCH?.trim() || 'develop'`
- **PR 作成**: `src/integrations/github/pull-request.ts:166`
  - ベースブランチの決定ロジック
- **ブランチ管理**: `src/core/workflow/branch-management.ts:109`
  - hotfix ブランチの特殊処理
- **単体テスト**: `tests/core/config/github-config.test.ts:13,25,31,37`
  - 環境変数の読み込みテスト

### 環境変数の命名規則（既存例）

| 環境変数 | パターン | 用途 |
|---------|---------|------|
| `GITHUB_TOKEN` | `GITHUB_*` | GitHub API 認証 |
| `GITHUB_OWNER` | `GITHUB_*` | GitHub リポジトリ所有者 |
| `GITHUB_REPO` | `GITHUB_*` | GitHub リポジトリ名 |
| `PROTECTED_BRANCHES` | `*_BRANCHES` | Git ブランチ保護リスト |
| `BASE_BRANCH` | `*_BRANCH` | Git ブランチ管理の基本設定 |

### 関連ドキュメント

- [ARCHITECTURE.md](./docs/ARCHITECTURE.md) - 3層アーキテクチャ設計
- [QUICK_START.md](./docs/QUICK_START.md) - 環境変数設定手順
- [CLAUDE.md](./CLAUDE.md) - プロジェクト規約・セキュリティ基本原則
