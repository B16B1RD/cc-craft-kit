# データベース廃止前の仕様書情報が移行できていない

**仕様書 ID:** 7ae68b97-e109-439f-ba52-afe3737132e8
**フェーズ:** design
**作成日時:** 2025/12/05 23:45:30
**更新日時:** 2025/12/06 00:00:15

---

## 1. 背景と目的

### 背景

cc-craft-kit は PR #887 でデータベース（SQLite）を廃止し、JSON ファイルベースのストレージに移行した。しかし、移行時に以下の問題が発生している:

1. **データ移行の不完全性**: 旧 DB に 187 件の仕様書（全て completed）が存在するが、JSON には 34 件のみ登録されている（移行率 18.2%）
2. **ファイルとメタデータの不整合**: `.cc-craft-kit/specs/` に 189 件の .md ファイルが存在するが、`specs.json` には 34 件のみ
3. **ブランチフィルタリングの問題**: `/cft:status` がブランチ名でフィルタリングするため、他ブランチの仕様書が表示されない

例えば、`/cft:status` で件数に反映されていない。

### 目的

データベース廃止前の仕様書情報を完全に JSON ストレージに移行し、`/cft:status` で正確な仕様書件数が表示されるようにする。

---

## 2. 対象ユーザー

cc-craft-kit を使用する開発者（プロジェクトの仕様書履歴を確認したいユーザー）

---

## 3. 受け入れ基準

### 必須要件

- [ ] `/cft:status` で全ての仕様書が件数に反映される
- [ ] 旧 DB の 187 件の completed 仕様書が JSON に移行される

### 機能要件

- [ ] `.cc-craft-kit/specs/` 内の全 .md ファイルが `specs.json` に登録される
- [ ] 仕様書のフェーズ情報（特に completed）が正しく移行される
- [ ] `/cft:status` のブランチフィルタリングを削除または改善する

### 非機能要件

- [ ] 移行処理は既存データを破壊しない
- [ ] 移行後の整合性チェックが可能である

---

## 4. 制約条件

- JSON ストレージ形式（`specs.json`）を使用する（DB への逆移行は不可）
- 仕様書ファイル（.md）のメタデータ形式を変更しない
- `src/core/storage/` 配下の既存インターフェースを維持する

---

## 5. 依存関係

- `src/core/storage/specs-storage.ts` - JSON 仕様書読み書き実装
- `src/core/storage/helpers.ts` - `getSpecsWithGitHubInfo` 実装（ブランチフィルタリング）
- `src/commands/status/get-status.ts` - `/cft:status` 用データ取得
- `src/core/sync/sync-service.ts` - ファイル→JSON 同期実装
- `.cc-craft-kit/meta/specs.json` - JSON 仕様書メタデータ
- `.cc-craft-kit/cc-craft-kit.db` - 旧 SQLite データベース（読み取り専用）

---

## 6. 参考情報

- PR #887: データベース廃止の実装
- `.cc-craft-kit/cc-craft-kit.db`: 旧データベース（187 件の completed 仕様書を含む）
- `src/core/storage/helpers.ts:107-111`: ブランチフィルタリングロジック
