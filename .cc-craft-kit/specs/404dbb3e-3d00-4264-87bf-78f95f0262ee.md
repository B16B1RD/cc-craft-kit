# /cft:spec-phase <id> completed の PR 作成のマージ先が間違っている

**仕様書 ID:** 404dbb3e-3d00-4264-87bf-78f95f0262ee
**フェーズ:** design
**作成日時:** 2025/11/25 00:10:19
**更新日時:** 2025/11/25 00:31:39

---

## 1. 背景と目的

### 背景

現在、`/cft:spec-phase <id> completed` コマンドで completed フェーズへ移行する際に PR が自動作成されますが、`gh pr create` コマンドに `--base` オプションが指定されていないため、デフォルトブランチ（main）へマージされる可能性があります。

プロジェクトのブランチ戦略では、以下のように PR のマージ先が定義されています:

- **通常の作業ブランチ** (feature/fix/refactor/docs/chore) → `develop` へマージ
- **hotfix ブランチ** → `main` へマージ

しかし、現在の実装では `.env` で定義された `BASE_BRANCH` 環境変数を参照していないため、マージ先が意図しないブランチになる問題があります。

**問題箇所**: `src/slash-commands/spec-phase.md` の Step 5（行172-196）

### 目的

PR 作成時に正しいマージ先ブランチを指定するよう修正します。

- hotfix ブランチの場合 → `main` へマージ
- その他のブランチの場合 → `.env` の `BASE_BRANCH` で指定されたブランチ（通常は `develop`）へマージ

---

## 2. 対象ユーザー

cc-craft-kit を使用する開発者全員。

特に、以下のシナリオで影響を受けます:

- 仕様書を completed フェーズに移行する開発者
- PR 作成の自動化を利用する開発者
- ブランチ戦略（develop / main）を採用しているチーム

---

## 3. 受け入れ基準

### 必須要件

- [ ] PR 作成時に `--base` オプションでマージ先ブランチを指定すること
- [ ] hotfix ブランチの場合、マージ先を `main` とすること
- [ ] その他のブランチの場合、マージ先を `.env` の `BASE_BRANCH` とすること
- [ ] `BASE_BRANCH` 環境変数が未設定の場合、デフォルト値 `develop` を使用すること

### 機能要件

- [ ] 現在のブランチ名から hotfix 判定を自動的に行うこと
- [ ] `gh pr create` コマンド実行前にマージ先ブランチを決定すること
- [ ] マージ先ブランチの決定ロジックをプロンプト内に実装すること（スクリプト修正不要）
- [ ] エラーメッセージでマージ先ブランチを表示すること（デバッグ用）

### 非機能要件

- [ ] プロンプトベース実装のみで完結すること（スクリプト変更なし）
- [ ] 既存の PR 作成フローを壊さないこと
- [ ] `.env` ファイルの変更は不要であること（既存の `BASE_BRANCH` を使用）

---

## 4. 制約条件

- **プロンプトベース実装**: スラッシュコマンド（.md ファイル）の修正のみで対応する
- **スクリプト変更禁止**: `src/commands/spec/phase.ts` の修正は行わない
- **環境変数依存**: `.env` の `BASE_BRANCH` が正しく設定されていることを前提とする
- **Bash ツールの使用**: ブランチ名取得、環境変数読み込みは Bash ツールで実装する
- **GitHub CLI**: `gh` コマンドがインストールされていることを前提とする

---

## 5. 依存関係

### 依存ファイル

- **`src/slash-commands/spec-phase.md`**: completed フェーズ移行時の PR 作成ロジック（修正対象）
- **`.env`**: `BASE_BRANCH` 環境変数の定義
- **`CLAUDE.md`**: ブランチ戦略の定義（参考情報）

### 関連コンポーネント

- **`src/core/config/github-config.ts`**: GitHub 設定の管理（`BASE_BRANCH` のデフォルト値）
- **`src/core/utils/branch-name-generator.ts`**: ブランチプレフィックス判定ロジック（参考情報）

### 前提条件

- `.env` に `BASE_BRANCH` が定義されていること（未設定の場合は `develop` がデフォルト）
- `gh` コマンドがインストールされ、認証済みであること
- Git リポジトリの `main` および `develop` ブランチが存在すること

---

## 6. 参考情報

### ブランチ戦略

- **GitHub Flow + develop ブランチ**: `CLAUDE.md` 行35-89
  - feature/fix/refactor/docs/chore → `develop` へマージ
  - hotfix → `main` へマージ

### 関連 Issue・PR

- 過去の類似修正があれば記載

### 参考ドキュメント

- [GitHub CLI: gh pr create](https://cli.github.com/manual/gh_pr_create)
- [cc-craft-kit CLAUDE.md](./CLAUDE.md) - ブランチ戦略セクション
