---
id: "843775ce-a132-4683-8a16-a309546a1be2"
name: "タスク完了時に対応する Sub Issue がクローズされない"
phase: "requirements"
branch_name: "fix/spec-843775ce-sub-issue-not-closed-on-completed"
github_issue_number: 936
pr_url: null
created_at: "2025-12-07T02:50:00.000Z"
updated_at: "2025-12-07T02:50:00.000Z"
---

# タスク完了時に対応する Sub Issue がクローズされない

## 1. 背景と目的

### 背景

`/cft:task done` でタスクを完了した際、対応する Sub Issue（タスク Issue）がクローズされない。

本来の動作フロー:
1. タスク完了時（`/cft:task done`）→ 対応する Sub Issue をクローズ
2. 全タスク完了後、completed フェーズ移行時 → 親 Issue をクローズ

実際に発生した事例:

- 仕様書 #905「構成見直し」の実装中、各タスクを完了
- タスク完了時に対応する Sub Issue #912〜#934 がクローズされなかった
- completed フェーズ移行時に親 Issue #905 のみクローズ
- Sub Issue（23 件）がオープンのまま残っていた

### 目的

タスク完了時（`/cft:task done`）に、対応する Sub Issue を自動的にクローズするように修正する。

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] タスク完了時に、対応する Sub Issue を特定できる
- [ ] 特定した Sub Issue をクローズする
- [ ] クローズ時に適切なコメントを残す

### 機能要件

- [ ] `/cft:task done` 実行時に対応する Sub Issue を自動クローズ
- [ ] タスクと Sub Issue の対応関係を仕様書内のタスクリストから特定（Issue 番号の記載）

### 非機能要件

- [ ] クローズ処理は並列実行で高速化
- [ ] クローズ失敗時もエラーで処理を中断しない（警告表示のみ）

---

## 4. 制約条件

- `gh` CLI のみで実装（Octokit 不使用）
- 親 Issue と Sub Issue の関連付け方法は現在の実装に依存

---

## 5. 依存関係

- `/cft:task` コマンド（`.claude/commands/cft/task.md`）

---

## 6. 参考情報

- 発生した Issue: #905（親）、#912〜#934（Sub Issue、23 件）
