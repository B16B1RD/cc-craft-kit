---
id: "843775ce-a132-4683-8a16-a309546a1be2"
name: "completed フェーズ移行時に Sub Issue がクローズされない"
phase: "requirements"
branch_name: "fix/spec-843775ce-sub-issue-not-closed-on-completed"
github_issue_number: 936
pr_url: null
created_at: "2025-12-07T02:50:00.000Z"
updated_at: "2025-12-07T02:50:00.000Z"
---

# completed フェーズ移行時に Sub Issue がクローズされない

## 1. 背景と目的

### 背景

`/cft:spec phase <id> completed` で仕様書を completed フェーズに移行した際、親 Issue はクローズされるが、関連する Sub Issue（タスク Issue）がクローズされずに残ってしまう。

実際に発生した事例:

- 仕様書 #905「構成見直し」を completed に移行
- 親 Issue #905 はクローズされた
- Sub Issue #912〜#934（23 件）がオープンのまま残っている

### 目的

completed フェーズ移行時に、親 Issue だけでなく関連する Sub Issue もすべてクローズするように修正する。

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] completed フェーズ移行時に、親 Issue に関連する Sub Issue をすべて特定できる
- [ ] 特定した Sub Issue をすべてクローズする
- [ ] クローズ時に適切なコメントを残す

### 機能要件

- [ ] `/cft:spec phase <id> completed` 実行時に Sub Issue を自動クローズ
- [ ] Sub Issue の特定方法を実装（Issue 本文内のリンクまたはラベルで関連付け）

### 非機能要件

- [ ] クローズ処理は並列実行で高速化
- [ ] クローズ失敗時もエラーで処理を中断しない（警告表示のみ）

---

## 4. 制約条件

- `gh` CLI のみで実装（Octokit 不使用）
- 親 Issue と Sub Issue の関連付け方法は現在の実装に依存

---

## 5. 依存関係

- `/cft:spec phase` コマンド（`.claude/commands/cft/spec.md`）

---

## 6. 参考情報

- 発生した Issue: #905（親）、#912〜#934（Sub Issue、23 件）
