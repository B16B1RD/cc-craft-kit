---
id: "55e838a5-796f-46c3-958c-12c08c02088f"
name: "GitHub Actions のエラーを解決"
phase: "completed"
branch_name: "main"
github_issue_number: null
pr_url: null
created_at: "2025-11-19T21:39:42Z"
updated_at: "2025-11-19T22:08:24Z"
---

# GitHub Actions のエラーを解決


## 1. 背景と目的

### 背景

GitHub Actions の CI ワークフローが連続して失敗しています。ログを確認した結果、`tests/integrations/event-logging.test.ts` で以下のエラーが発生していることが判明しました。

```
SqliteError: no such table: specs
SqliteError: no such table: logs
```

テストで `getDatabase()` を呼び出していますが、データベーステーブルが存在しません。これは、テストセットアップでマイグレーションが実行されていないためです。

### 目的

テストセットアップで自動的にデータベースマイグレーションを実行し、GitHub Actions の CI ワークフローを正常に動作させることを目的としています。
---

## 2. 対象ユーザー

cc-craft-kit の開発者および CI/CD パイプラインを使用する全ユーザー
---

## 3. 受け入れ基準

### 必須要件

- [ ] `tests/setup.ts` でデータベースマイグレーションが自動実行される
- [ ] GitHub Actions の CI ワークフローですべてのテストが成功する
- [ ] ローカル環境でもテストが引き続き正常に動作する

### 機能要件

- [ ] テスト環境でインメモリデータベース（`:memory:`）が正しく初期化される
- [ ] マイグレーションが失敗した場合、適切なエラーメッセージが表示される
- [ ] テスト実行後、データベース接続が正しくクローズされる

### 非機能要件

- [ ] テスト実行時間が大幅に増加しない（マイグレーション実行による遅延を最小化）
- [ ] テスト間でデータベース状態が分離されている
---

## 4. 制約条件

- Jest のグローバルセットアップ（`tests/setup.ts`）で実装する
- `migrateToLatest()` 関数を使用してマイグレーションを実行する
- エラーハンドリングを適切に実装し、テスト失敗時のデバッグを容易にする
---

## 5. 依存関係

- `src/core/database/migrator.ts` の `migrateToLatest()` 関数
- `src/core/database/connection.ts` の `getDatabase()`, `closeDatabase()` 関数
- `tests/setup.ts` の Jest グローバルセットアップ
---

## 6. 参考情報

- GitHub Actions 失敗ログ: https://github.com/B16B1RD/cc-craft-kit/actions/runs/19499627101
- 関連ファイル:
  - `.github/workflows/ci.yml`
  - `tests/setup.ts`
  - `tests/integrations/event-logging.test.ts`
  - `src/core/database/migrator.ts`
