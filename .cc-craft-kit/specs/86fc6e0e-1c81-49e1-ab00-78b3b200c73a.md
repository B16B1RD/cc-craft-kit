# インストール構成の見直し

**仕様書 ID:** 86fc6e0e-1c81-49e1-ab00-78b3b200c73a
**フェーズ:** requirements
**作成日時:** 2025/12/04 18:08:20
**更新日時:** 2025/12/04 18:15:00

---

## 1. 背景と目的

### 背景

現在のインストール構成には以下の問題がある:

1. **不要なシンボリックリンク**
   - `.claude/commands/cft` → `../../src/slash-commands`（開発環境）
   - シンボリックリンクを使う理由がない。直接ファイルを配置すればよい

2. **`.cc-craft-kit/` に不要なファイルが大量にある**
   - 開発用スクリプト（`fix-*.ts`, `check-*.ts` など 30 ファイル以上）
   - バックアップ DB、テスト用アーカイブ
   - ユーザー環境には不要

3. **スキル・サブエージェントが適切な場所にない**
   - `.cc-craft-kit/core/skills/impl/` に配置されている
   - `.cc-craft-kit/core/subagents/impl/` に配置されている
   - Claude Code の規約では `.claude/skills/` と `.claude/agents/` に配置すべき

4. **役割の重複・曖昧さ**
   - `.cc-craft-kit/slash-commands/` と `.claude/commands/cft/` が重複
   - どちらがマスターなのか不明確

### 目的

インストール構成を整理し、Claude Code の規約に従った配置にする:
1. シンボリックリンクを廃止し、直接ファイル配置に変更
2. `.cc-craft-kit/` には本当に必要なもののみを配置
3. スキル・サブエージェントを `.claude/` 配下の適切な場所に配置
4. ユーザー環境での Git 管理方針を明確化

---

## 2. 対象ユーザー

cc-craft-kit をプロジェクトにインストールして使用する開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] シンボリックリンクを廃止し、直接ファイル配置に変更すること
- [ ] スキルが `.claude/skills/` に配置されること
- [ ] サブエージェントが `.claude/agents/` に配置されること
- [ ] スラッシュコマンドが `.claude/commands/cft/` に直接配置されること
- [ ] 開発用スクリプトがユーザー環境にインストールされないこと

### 機能要件

- [ ] `.cc-craft-kit/` にはランタイムに必要なファイルのみ配置
  - `core/` - TypeScript 実装（DB操作、GitHub API等）
  - `specs/` - 仕様書データ
  - `cc-craft-kit.db` - データベース
- [ ] インストールスクリプトが適切な場所にファイルを配置すること

### 非機能要件

- [ ] インストール後のファイル数が現在より大幅に削減されること
- [ ] Windows/macOS/Linux の全プラットフォームで動作すること
- [ ] ドキュメントが更新されていること

---

## 4. 制約条件

- 既存の Claude Code との互換性を維持すること
- プロンプトファースト原則に従い、Markdown で実現できるものは Markdown で
- 後方互換性: 既存ユーザーへのマイグレーションパスを提供

---

## 5. 依存関係

### 関連ファイル
- `scripts/install.sh` - インストールスクリプト（大幅な変更が必要）
- `src/scripts/sync-dogfood.ts` - 同期スクリプト（見直しが必要）
- `.github/workflows/release.yml` - リリースワークフロー（アーカイブ構成の変更）
- `.gitignore` - Git 無視設定

### 関連コンポーネント
- `.cc-craft-kit/core/skills/impl/` → `.claude/skills/` に移動
- `.cc-craft-kit/core/subagents/impl/` → `.claude/agents/` に移動
- `.cc-craft-kit/slash-commands/` → `.claude/commands/cft/` に移動

---

## 6. 参考情報

### 現状の問題点（詳細）

**インストールされる不要なファイル（一部）:**
```
.cc-craft-kit/scripts/fix-issue-106.ts
.cc-craft-kit/scripts/fix-branch-names.ts
.cc-craft-kit/scripts/cleanup-duplicate-issues.ts
.cc-craft-kit/scripts/check-spec-ae5bffaf.ts
.cc-craft-kit/backups/cc-craft-kit-2025-11-19T05-20-23-105Z.db
.cc-craft-kit/test-archive.tar.gz
.cc-craft-kit/cc-craft-kit-recovered.db
```

**スキル・サブエージェントの現在位置:**
```
.cc-craft-kit/core/skills/impl/
  - architecture-diagram-generator.ts
  - test-coverage-reporter.ts
  - code-quality-analyzer.ts
  - github-issue-sync.ts
  - requirements-doc-generator.ts

.cc-craft-kit/core/subagents/impl/
  - requirements-analyzer.ts
  - test-creator.ts
  - documentation-writer.ts
  - architect-designer.ts
  - code-generator.ts
  - code-reviewer.ts
  - task-breakdowner.ts
```

### あるべき構成

```
.claude/
├── commands/
│   └── cft/                    # スラッシュコマンド（Markdown 直接配置）
│       ├── task.md
│       ├── spec-create.md
│       └── ...
├── skills/                     # スキル定義（Markdown）
│   ├── architecture-diagram-generator/
│   ├── test-coverage-reporter/
│   └── ...
└── agents/                     # サブエージェント定義（Markdown）
    ├── requirements-analyzer.md
    ├── test-creator.md
    └── ...

.cc-craft-kit/                  # ランタイム専用
├── core/                       # TypeScript 実装
│   ├── database/
│   ├── workflow/
│   └── ...（DB操作、GitHub API等に必要なもののみ）
├── specs/                      # 仕様書データ
└── cc-craft-kit.db             # データベース
```

### Git 管理方針（ユーザー環境）

| ディレクトリ | Git 管理 | 理由 |
|-------------|----------|------|
| `.claude/commands/cft/` | ✗ 除外 | ツール提供、変更不可 |
| `.claude/skills/` | ✗ 除外 | ツール提供、変更不可 |
| `.claude/agents/` | △ 選択 | カスタマイズする場合は管理 |
| `.cc-craft-kit/specs/` | ✓ 管理 | プロジェクト固有データ |
| `.cc-craft-kit/cc-craft-kit.db` | ✗ 除外 | 生成ファイル |
