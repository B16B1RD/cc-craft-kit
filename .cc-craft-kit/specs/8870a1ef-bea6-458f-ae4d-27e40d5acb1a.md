# spec-create の日時フォーマット不正

**仕様書 ID:** 8870a1ef-bea6-458f-ae4d-27e40d5acb1a
**フェーズ:** tasks
**作成日時:** 2025/11/25 11:05:30
**更新日時:** 2025/11/25 11:07:45

---

## 1. 背景と目的

### 背景

`/cft:spec-create` で作成される仕様書の createdAt/updatedAt フォーマットが YYYY-MM-DD HH:mm になっており、バリデーターが期待する YYYY/MM/DD HH:MM:SS と異なるため無効な仕様書が作成される。

### 目的

`/cft:spec-create` コマンドで作成される仕様書の日時フォーマットを、バリデーターが期待する `YYYY/MM/DD HH:MM:SS` 形式に修正し、無効な仕様書が作成されないようにする。

---

## 2. 対象ユーザー

- cc-craft-kit を使用する開発者
- `/cft:spec-create` コマンドを実行するユーザー

---

## 3. 受け入れ基準

### 必須要件

- [ ] `/cft:spec-create` で作成される仕様書の `createdAt` が `YYYY/MM/DD HH:MM:SS` 形式であること
- [ ] `/cft:spec-create` で作成される仕様書の `updatedAt` が `YYYY/MM/DD HH:MM:SS` 形式であること
- [ ] `spec-file-validator.ts` のバリデーションを通過すること

### 機能要件

- [ ] `src/slash-commands/spec-create.md` の日時フォーマット指定を修正する
- [ ] 修正後、新規作成した仕様書がデータベース整合性チェックで警告されないこと

### 非機能要件

- [ ] 既存の仕様書への影響がないこと
- [ ] 他のスラッシュコマンド（`spec-phase.md` など）との整合性が保たれていること

---

## 4. 制約条件

- 日時フォーマットは `YYYY/MM/DD HH:MM:SS` 形式に統一する（`spec-file-validator.ts` の検証ルールに準拠）
- プロンプトベースの修正のみで対応（スクリプト変更は不要）

---

## 5. 依存関係

- `src/core/validators/spec-file-validator.ts` - 日時フォーマットのバリデーションルール
- `src/slash-commands/spec-phase.md` - 参考実装（正しいフォーマットを使用）

---

## 6. 参考情報

- 問題の仕様書: `2cfbe492-2629-4451-92ab-fbaf6ac1b77d.md`
- 現在のフォーマット: `YYYY-MM-DD HH:mm`
- 期待されるフォーマット: `YYYY/MM/DD HH:MM:SS`

---

## 7. 設計詳細

### 7.1 アーキテクチャ設計

#### 全体構成

```
spec-create.md (プロンプト定義)
    │
    │ Claude がプロンプトを解釈して仕様書を生成
    │
    ▼
.cc-craft-kit/specs/<id>.md (生成された仕様書)
    │
    │ バリデーション
    │
    ▼
spec-file-validator.ts (検証ロジック)
    │
    │ 正規表現でフォーマットチェック
    │ /^\d{4}\/\d{2}\/\d{2} \d{2}:\d{2}:\d{2}$/
    │
    ▼
OK / NG (整合性チェック結果)
```

#### 設計方針

プロンプトベースの修正のみで対応。スクリプト変更は不要。

### 7.2 実装方針

#### 修正対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `src/slash-commands/spec-create.md` | 113-114行目の日時フォーマット指定を修正 |

#### 修正内容

**修正前（113-114行目）:**
```markdown
**作成日時:** (現在の日時を YYYY-MM-DD HH:mm 形式で挿入)
**更新日時:** (現在の日時を YYYY-MM-DD HH:mm 形式で挿入)
```

**修正後:**
```markdown
**作成日時:** (現在の日時を YYYY/MM/DD HH:mm:ss 形式で挿入)
**更新日時:** (現在の日時を YYYY/MM/DD HH:mm:ss 形式で挿入)
```

### 7.3 機能マッピング

| 機能 | 現在の実装 | 新しい実装 | 実装場所 |
|-----|----------|----------|---------|
| 日時フォーマット指定 | `YYYY-MM-DD HH:mm` | `YYYY/MM/DD HH:mm:ss` | spec-create.md:113-114 |

### 7.4 テスト戦略

| テスト対象 | テスト内容 | 検証方法 |
|----------|----------|---------|
| 新規仕様書作成 | `/cft:spec-create` で作成した仕様書が正しいフォーマットか | 整合性チェックで警告が出ないこと |
| バリデーション | `spec-file-validator.ts` の検証を通過するか | `npx tsx .cc-craft-kit/scripts/repair-database.ts` |
| 既存仕様書 | 既存の仕様書に影響がないこと | 整合性チェックの警告数が増えないこと |

### 7.5 移行計画

#### Phase 1: 修正適用

1. `src/slash-commands/spec-create.md` の113-114行目を修正
2. `npm run sync:dogfood` で同期

#### Phase 2: 検証

1. `/cft:spec-create` で新規仕様書を作成してテスト
2. 整合性チェックで警告が出ないことを確認

#### Phase 3: 既存データの修復（オプション）

1. `npx tsx .cc-craft-kit/scripts/repair-database.ts` で既存の不正な仕様書を修復
2. 問題の仕様書 `2cfbe492-...` の `createdAt` を手動で修正

---

## 8. 実装タスクリスト

- [ ] `src/slash-commands/spec-create.md` の113-114行目を修正（`YYYY-MM-DD HH:mm` → `YYYY/MM/DD HH:mm:ss`）
- [ ] `npm run sync:dogfood` で同期
- [ ] 既存の不正な仕様書 `2cfbe492-2629-4451-92ab-fbaf6ac1b77d.md` の `createdAt` を修正
- [ ] 整合性チェックで警告が出ないことを確認
