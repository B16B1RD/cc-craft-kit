# .env の GITHUB_DEFAULT_BASE_BRANCH は不要では？

**仕様書 ID:** b1098fbd-2d4c-464d-8831-7cebc42c1f0d
**フェーズ:** requirements
**作成日時:** 2025/11/24 13:21:31
**更新日時:** 2025/11/24 13:21:31

---

## 1. 背景と目的

### 背景

各ブランチは、BASE_BRANCH から派生して作る。このため、PR は必ず BASE_BRANCH にマージされなければならない。間違っているだろうか。

### 目的

`GITHUB_DEFAULT_BASE_BRANCH` と `BASE_BRANCH` の役割分担を検証し、環境変数の必要性を明確にする。両変数が適切に使い分けられているか、またはどちらか一方に統合すべきかを判断する。

---

## 2. 対象ユーザー

- **cc-craft-kit 開発者**: ブランチ戦略と環境変数の設計を理解する必要がある開発者
- **プロジェクトメンテナー**: `.env.example` のドキュメント管理を行う担当者
- **エンドユーザー（開発者）**: cc-craft-kit を使用して仕様駆動開発を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] `BASE_BRANCH` と `GITHUB_DEFAULT_BASE_BRANCH` の現在の使用箇所を特定する
- [ ] 両変数の役割分担が適切かどうかを検証する
- [ ] 統合可能か、または分離すべきかの結論を導く

### 機能要件

- [ ] `BASE_BRANCH` の使用箇所をすべて洗い出す（ブランチ作成、ブランチ復帰など）
- [ ] `GITHUB_DEFAULT_BASE_BRANCH` の使用箇所をすべて洗い出す（PR 作成、マージ先決定など）
- [ ] 両変数が異なる目的で使用されているか確認する
- [ ] hotfix ブランチなどの特殊処理で適切に使い分けられているか確認する

### 非機能要件

- [ ] 既存の実装パターンを破壊しない
- [ ] `.env.example` のドキュメントが明確である
- [ ] テストケースで環境変数の動作を保証している

---

## 4. 制約条件

- **後方互換性**: 既存の環境変数を使用しているユーザーへの影響を最小化する必要がある
- **ブランチ戦略**: GitHub Flow + develop ブランチのモデルに準拠する
- **型安全性**: TypeScript の型システムで環境変数を管理する（`GitHubConfig` インターフェース）
- **デフォルト値**: 両変数のデフォルト値は `develop` に統一されている
- **保護ブランチ**: `main`, `develop` は保護ブランチとして扱う

---

## 5. 依存関係

### 関連ファイル

- `src/core/config/github-config.ts` - 環境変数読み込み処理
- `src/core/git/branch-creation.ts` - ブランチ作成ロジック（`BASE_BRANCH` 使用）
- `src/commands/spec/create.ts` - 仕様書作成コマンド（ブランチ復帰処理）
- `src/core/workflow/branch-management.ts` - PR 作成ロジック（`GITHUB_DEFAULT_BASE_BRANCH` 使用）
- `tests/core/config/github-config.test.ts` - 環境変数のテストケース
- `.env.example` - 環境変数のドキュメント

### 関連仕様書

- **570644e2-814c-4f8b-a42b-b5f654e610e4**: 「開発キットが .env の BASE_BRANCH や GITHUB_DEFAULT_BASE_BRANCH を参照していない」（completed フェーズ）
  - この仕様で `BASE_BRANCH` と `GITHUB_DEFAULT_BASE_BRANCH` の実装が完了している

### 依存コンポーネント

- **EventBus**: フェーズ遷移時のイベント処理
- **Kysely**: データベース操作（仕様書レコード管理）
- **child_process**: Git コマンド実行（ブランチ作成、切り替え）

---

## 6. 参考情報

### コードベース解析結果

コードベース解析により、以下の結論が得られています:

#### 結論: 両方の環境変数が必要

| 環境変数 | 用途 | 使用タイミング | デフォルト値 |
|---|---|---|---|
| `BASE_BRANCH` | ブランチ作成の起点 | `/cft:spec-create` 実行時、ブランチ作成時 | `develop` |
| `GITHUB_DEFAULT_BASE_BRANCH` | PR のマージ先 | `completed` フェーズ移行時（PR自動作成） | `develop` |

**分離の理由:**

1. **異なるタイミング**: ブランチ作成時（起点） vs PR 作成時（マージ先）
2. **柔軟な運用**: staging 環境での検証が必要な場合、異なる値を設定可能
   - 例: `BASE_BRANCH=develop`, `GITHUB_DEFAULT_BASE_BRANCH=staging`
3. **hotfix 特殊処理**: hotfix ブランチの場合、PR 先は自動的に `main` に変更される

### 実装パターン

**ブランチ作成処理** (`src/core/git/branch-creation.ts:131`):
```typescript
execFileSync('git', ['branch', branchName, baseBranch], { stdio: 'pipe' });
```

**PR 作成処理** (`src/core/workflow/branch-management.ts:109`):
```typescript
const baseBranch = isHotfixBranch(currentBranch) ? 'main' : config.defaultBaseBranch;
```

### 関連 GitHub Issue

- [#338](https://github.com/B16B1RD/cc-craft-kit/issues/338): この仕様の実装タスク
