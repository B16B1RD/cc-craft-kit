# 不要なスクリプトを削除

**仕様書 ID:** 4bd4f16b-a4fd-49d8-977c-9d3cb790ec21
**フェーズ:** completed
**作成日時:** 2025/11/19 20:14:23
**更新日時:** 2025/11/19 20:23:15

---

## 1. 背景と目的

### 背景

開発中のバグ解決やデバッグ目的で、`scripts/` および `src/scripts/` ディレクトリ内に多数の一時的なスクリプトが作成されました。これらのファイルは以下のような特徴があります。

- バグ調査のためのその場しのぎのスクリプト
- 特定の Issue 番号に関連した修正スクリプト（例: `fix-issue-106.ts`, `fix-issue-151.ts`）
- 特定の spec ID に関連したチェックスクリプト（例: `check-spec-ae5bffaf.ts`, `fix-spec-ae5bffaf.ts`）
- データベース整合性チェック用の一時スクリプト（例: `cleanup-orphaned-records.ts`, `fix-database-cleanup.ts`）
- GitHub 連携関連の一時スクリプト（例: `fix-github-sync-records.ts`, `update-spec-ae5bffaf-phase.ts`）

これらのスクリプトは問題解決後も残っており、プロジェクトの保守性を低下させています。

### 目的

プロジェクトのコードベースをクリーンに保つため、以下を目的とします。

1. 一時的なデバッグ・修正スクリプトを削除
2. 永続的に必要なスクリプトのみを残す
3. 将来的な一時スクリプトの管理方針を明確化

---

## 2. 対象ユーザー

- cc-craft-kit 開発者
- プロジェクトメンテナー

---

## 3. 受け入れ基準

### 必須要件

- [ ] `src/scripts/` 内の一時的な修正スクリプトを削除
  - `check-spec-ae5bffaf.ts`
  - `cleanup-orphaned-records.ts`
  - `fix-database-cleanup.ts`
  - `fix-github-sync-records.ts`
  - `fix-issue-106.ts`
  - `fix-issue-151.ts`
  - `fix-spec-ae5bffaf.ts`
  - `update-spec-ae5bffaf-phase.ts`

- [ ] `scripts/` ディレクトリ内の一時スクリプトを削除
  - `check-backup.ts`
  - `check-issue-150.ts`
  - `check-orphan-issues.ts`
  - `check-project-item-ids.ts`
  - `check-project-status.ts`
  - `list-project-items.ts`
  - `verify-open-issues.ts`

### 機能要件

- [ ] 永続的に必要なスクリプトは保持する
  - `src/scripts/check-sync.ts` - ドッグフーディング同期チェック
  - `src/scripts/migrate-structure.ts` - 構造マイグレーション
  - `src/scripts/migrate-takumi-to-cc-craft-kit.ts` - プロジェクト名変更マイグレーション
  - `src/scripts/rename-project.ts` - プロジェクトリネーム
  - `src/scripts/repair-database.ts` - データベース修復ツール
  - `src/scripts/replace-takumi-references.ts` - 参照置換
  - `src/scripts/sync-dogfood.ts` - ドッグフーディング同期

- [ ] `scripts/` 内の永続的に必要なスクリプトを保持
  - `scripts/create-first-spec.ts` - 初期仕様書作成
  - `scripts/create-github-issue.ts` - Issue 作成ツール
  - `scripts/create-mcp-error-spec.ts` - MCP エラー仕様書作成
  - `scripts/init-dogfooding.ts` - ドッグフーディング初期化
  - `scripts/install.sh` - インストールスクリプト
  - その他ユーティリティスクリプト

### 非機能要件

- [ ] 削除後もプロジェクトの全テストが成功すること
- [ ] Git 履歴から完全に削除する必要はない（通常の `git rm` で削除）

---

## 4. 制約条件

- 削除するスクリプトが他のコードから参照されていないことを確認する必要がある
- データベース修復スクリプト（`repair-database.ts`）は保持する
- マイグレーションスクリプトは履歴的な価値があるため保持する

---

## 5. 依存関係

なし

---

## 6. 参考情報

- Issue #151: データベース整合性問題の修正履歴
- Issue #106: GitHub 同期問題の修正履歴
- コミット履歴: これらのスクリプトが作成された背景

---

## 7. 設計

### 7.1. 削除対象ファイルの分類

#### A. src/scripts/ 内の一時スクリプト（削除対象）

| ファイル名 | 作成理由 | 削除可否 |
|---|---|---|
| `check-spec-ae5bffaf.ts` | 特定 spec の調査用 | ✅ 削除可 |
| `cleanup-orphaned-records.ts` | データベース整合性修正 | ✅ 削除可（問題解決済み） |
| `fix-database-cleanup.ts` | データベース整合性修正 | ✅ 削除可（問題解決済み） |
| `fix-github-sync-records.ts` | GitHub 同期問題修正 | ✅ 削除可（問題解決済み） |
| `fix-issue-106.ts` | Issue #106 修正用 | ✅ 削除可（問題解決済み） |
| `fix-issue-151.ts` | Issue #151 修正用 | ✅ 削除可（問題解決済み） |
| `fix-spec-ae5bffaf.ts` | 特定 spec 修正用 | ✅ 削除可（問題解決済み） |
| `update-spec-ae5bffaf-phase.ts` | 特定 spec フェーズ更新 | ✅ 削除可（問題解決済み） |

#### B. scripts/ 内の一時スクリプト（削除対象）

| ファイル名 | 作成理由 | 削除可否 |
|---|---|---|
| `check-backup.ts` | バックアップ機能調査 | ✅ 削除可 |
| `check-issue-150.ts` | Issue #150 調査用 | ✅ 削除可 |
| `check-orphan-issues.ts` | 孤立 Issue 調査 | ✅ 削除可 |
| `check-project-item-ids.ts` | Project item ID 確認 | ✅ 削除可 |
| `check-project-status.ts` | Project ステータス確認 | ✅ 削除可 |
| `list-project-items.ts` | Project アイテム一覧 | ✅ 削除可 |
| `verify-open-issues.ts` | 未クローズ Issue 確認 | ✅ 削除可 |

#### C. 保持するスクリプト（削除対象外）

**src/scripts/ 内**:
- `check-sync.ts` - ドッグフーディング同期チェック（開発ワークフローに必須）
- `migrate-structure.ts` - ディレクトリ構造マイグレーション（履歴的価値）
- `migrate-takumi-to-cc-craft-kit.ts` - プロジェクト名変更マイグレーション（履歴的価値）
- `rename-project.ts` - プロジェクトリネームツール（再利用可能）
- `repair-database.ts` - データベース修復ツール（保守運用に必須）
- `replace-takumi-references.ts` - 参照置換ツール（履歴的価値）
- `sync-dogfood.ts` - ドッグフーディング同期実行（開発ワークフローに必須）

**scripts/ 内**:
- その他のユーティリティスクリプト（個別に精査が必要）

### 7.2. 削除手順

#### ステップ 1: 参照確認

削除対象ファイルが他のコードから import されていないことを確認します。

```bash
# 各ファイルの参照をチェック
grep -r "check-spec-ae5bffaf" src/ .cc-craft-kit/ --exclude-dir=node_modules
grep -r "cleanup-orphaned-records" src/ .cc-craft-kit/ --exclude-dir=node_modules
# ... 以下同様に全削除対象ファイルをチェック
```

#### ステップ 2: Git による削除

```bash
# src/scripts/ 内の削除
git rm src/scripts/check-spec-ae5bffaf.ts
git rm src/scripts/cleanup-orphaned-records.ts
git rm src/scripts/fix-database-cleanup.ts
git rm src/scripts/fix-github-sync-records.ts
git rm src/scripts/fix-issue-106.ts
git rm src/scripts/fix-issue-151.ts
git rm src/scripts/fix-spec-ae5bffaf.ts
git rm src/scripts/update-spec-ae5bffaf-phase.ts

# scripts/ 内の削除
git rm scripts/check-backup.ts
git rm scripts/check-issue-150.ts
git rm scripts/check-orphan-issues.ts
git rm scripts/check-project-item-ids.ts
git rm scripts/check-project-status.ts
git rm scripts/list-project-items.ts
git rm scripts/verify-open-issues.ts
```

#### ステップ 3: テスト実行

```bash
# 全テストが成功することを確認
npm test

# 型チェック
npx tsc --noEmit

# Lint チェック
npm run lint
```

#### ステップ 4: コミット

```bash
git commit -m "chore: 不要なデバッグ・修正スクリプトを削除"
```

### 7.3. 将来的な一時スクリプト管理方針

今後、一時的なスクリプトを作成する際は、以下のガイドラインに従います。

1. **一時スクリプトの配置場所**: `scripts/temp/` または `src/scripts/temp/` を作成し、そこに配置
2. **ファイル名規則**: `temp-<purpose>-<date>.ts` 形式（例: `temp-fix-issue-123-20251119.ts`）
3. **削除タイミング**: 問題解決後、即座に削除
4. **Git 管理**: `.gitignore` に `scripts/temp/` と `src/scripts/temp/` を追加し、一時スクリプトをコミット対象外にする

### 7.4. リスク評価

| リスク | 影響度 | 対策 |
|---|---|---|
| 削除したスクリプトが実は必要だった | 低 | Git 履歴から復元可能 |
| 他のコードから参照されている | 低 | Grep で事前確認、テスト実行 |
| テストが失敗する | 低 | 削除前にテスト実行、失敗時は復元 |

---

## 8. 実装タスクリスト

### タスク 1: 削除対象ファイルの参照確認を実施

**目的**: 削除対象ファイルが他のコードから import されていないことを確認する

**作業内容**:
1. `src/scripts/` 内の削除対象 8 ファイルについて、`grep -r` で参照をチェック
2. `scripts/` 内の削除対象 7 ファイルについて、`grep -r` で参照をチェック
3. 参照が見つかった場合は、削除前に参照を削除または修正

**完了条件**:
- すべての削除対象ファイルが他のコードから参照されていないことを確認

---

### タスク 2: src/scripts/ 内の一時スクリプト8ファイルを削除

**目的**: src/scripts/ 内の一時的な修正スクリプトを削除する

**作業内容**:
```bash
git rm src/scripts/check-spec-ae5bffaf.ts
git rm src/scripts/cleanup-orphaned-records.ts
git rm src/scripts/fix-database-cleanup.ts
git rm src/scripts/fix-github-sync-records.ts
git rm src/scripts/fix-issue-106.ts
git rm src/scripts/fix-issue-151.ts
git rm src/scripts/fix-spec-ae5bffaf.ts
git rm src/scripts/update-spec-ae5bffaf-phase.ts
```

**完了条件**:
- 8 ファイルが Git から削除されている

---

### タスク 3: scripts/ 内の一時スクリプト7ファイルを削除

**目的**: scripts/ 内の一時的な調査スクリプトを削除する

**作業内容**:
```bash
git rm scripts/check-backup.ts
git rm scripts/check-issue-150.ts
git rm scripts/check-orphan-issues.ts
git rm scripts/check-project-item-ids.ts
git rm scripts/check-project-status.ts
git rm scripts/list-project-items.ts
git rm scripts/verify-open-issues.ts
```

**完了条件**:
- 7 ファイルが Git から削除されている

---

### タスク 4: .gitignore に scripts/temp/ と src/scripts/temp/ を追加

**目的**: 将来的な一時スクリプトを Git 管理対象外にする

**作業内容**:
1. `.gitignore` ファイルを開く
2. 以下の行を追加:
   ```
   # Temporary scripts
   scripts/temp/
   src/scripts/temp/
   ```

**完了条件**:
- `.gitignore` に一時スクリプトディレクトリが追加されている

---

### タスク 5: 削除後のテスト実行とコミット

**目的**: 削除後もプロジェクトが正常に動作することを確認し、変更をコミットする

**作業内容**:
1. 型チェック: `npx tsc --noEmit`
2. Lint チェック: `npm run lint`
3. テスト実行: `npm test`
4. すべて成功したらコミット:
   ```bash
   git commit -m "chore: 不要なデバッグ・修正スクリプトを削除

   - src/scripts/ 内の一時スクリプト8ファイルを削除
   - scripts/ 内の一時スクリプト7ファイルを削除
   - .gitignore に一時スクリプトディレクトリを追加
   "
   ```

**完了条件**:
- すべてのテストが成功
- 変更がコミットされている
