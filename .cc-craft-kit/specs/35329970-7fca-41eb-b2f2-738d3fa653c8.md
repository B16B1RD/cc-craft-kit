# /cft:spec-create 実行中にエラーが表示される

**仕様書 ID:** 35329970-7fca-41eb-b2f2-738d3fa653c8
**フェーズ:** requirements
**作成日時:** 2025/12/01 12:10:00
**更新日時:** 2025/12/01 12:10:00

---

## 1. 背景と目的

### 背景

`/cft:spec-create` コマンドの Step 4.5「ベースブランチの決定」において、以下の Bash コマンドを実行すると構文エラーが発生する：

```bash
BASE_BRANCH=$(grep '^BASE_BRANCH=' .env 2>/dev/null | cut -d'=' -f2 | tr -d '"' | xargs)
BASE_BRANCH=${BASE_BRANCH:-develop}
echo "$BASE_BRANCH"
```

エラーメッセージ:
```
/bin/bash: eval: 行 1: 予期しないトークン `(' 周辺に構文エラーがあります
/bin/bash: eval: 行 1: `BASE_BRANCH=\$ ( grep \^BASE_BRANCH\= .env 2>/dev/null < /dev/null | cut -d\= -f2 | tr -d '"' | xargs ) ; BASE_BRANCH='' ; echo '''
```

このエラーは Claude Code の Bash ツールがコマンド置換（`$()`）を正しく処理できないことが原因と考えられる。エラー発生後、フォールバックコマンドが実行されるが、処理フローが不安定になる。

### 目的

`/cft:spec-create` コマンドの Step 4.5 で使用する Bash コマンドを、Claude Code の Bash ツールで確実に動作する形式に修正する。

---

## 2. 対象ユーザー

cc-craft-kit を使用する開発者。

---

## 3. 受け入れ基準

### 必須要件

- [ ] Step 4.5 の Bash コマンドがエラーなく実行されること
- [ ] `.env` から `BASE_BRANCH` を正しく読み取れること
- [ ] `.env` に `BASE_BRANCH` が未設定の場合、デフォルト値 `develop` が使用されること

### 機能要件

- [ ] コマンド置換（`$()`）を使用しない形式に変更すること
- [ ] 複数行コマンドではなく、単一コマンドまたはパイプラインで実現すること
- [ ] エラー発生時のフォールバック動作が維持されること

### 非機能要件

- [ ] 修正後のコマンドが可読性を維持すること
- [ ] 他のスラッシュコマンドで同様のパターンを使用している箇所がないか確認すること

---

## 4. 制約条件

- **プロンプトファースト原則**: 本修正はプロンプト（`.md`ファイル）のみで実現可能
- **変更対象ファイル**: `src/slash-commands/spec-create.md` の Step 4.5 セクション
- **Claude Code Bash ツールの制限**: コマンド置換（`$()`）、変数展開（`${VAR:-default}`）が正しく動作しない可能性がある

---

## 5. 依存関係

### 関連ファイル

| ファイル | 役割 | 修正必要 |
|---------|------|---------|
| `src/slash-commands/spec-create.md` | `/cft:spec-create` コマンド定義 | ✓ 要修正 |
| `.cc-craft-kit/slash-commands/spec-create.md` | 自動生成版（同期管理） | 自動同期 |

### 関連仕様書

- `112bb02d-42c2-4943-9f22-75b3c6c4e733`: /cft:spec-create をどのブランチにいても中断することなく実行できるようにする（同時に修正可能）

---

## 6. 参考情報

- エラー発生時の会話ログ（仕様書説明に記載）
- 現在の実装: `src/slash-commands/spec-create.md` Step 4.5
- フォールバックコマンド: `grep '^BASE_BRANCH=' .env 2>/dev/null | cut -d'=' -f2 | tr -d '"' || echo "develop"`
