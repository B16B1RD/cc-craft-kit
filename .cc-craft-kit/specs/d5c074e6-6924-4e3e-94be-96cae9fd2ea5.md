# フェーズおよび Issue ステータスの見直し

**仕様書 ID:** d5c074e6-6924-4e3e-94be-96cae9fd2ea5
**フェーズ:** requirements
**作成日時:** 2025/12/04 18:30:00
**更新日時:** 2025/12/04 18:30:00

---

## 1. 背景と目的

### 背景

GitHub Projects の Issue のステータス遷移を以下のように見直したい。

1. /cft:spec-create → Todo
2. /cft:spec-phase <id> design → In Progress
3. /cft:spec-phase <id> implementation → In Progress
4. /cft:spec-phase <id> completed → In Review
5. /cft:pr-cleanup → Done

なお、completed フェーズで In Review となるのは違和感があるので、PR を作成してレビュー待ちである「In Review」を表現する新たなフェーズを設けたい。

さらに、/cft:pr-cleanup コマンドは、completed フェーズで行うこととしたい。

1. /cft:spec-create → Todo
2. /cft:spec-phase <id> design → In Progress
3. /cft:spec-phase <id> implementation → In Progress
4. /cft:spec-phase <id> xxx → In Review（従来の /cft:phase <id> completed の処理）
5. /cft:spec-phase <id> completed → Done（従来の /cft:pr-cleanup の処理）

### 目的

フェーズと GitHub Projects Issue ステータスの対応関係を見直し、より直感的で実態に即したワークフローを実現する。特に「レビュー待ち」状態を明確に表現する新フェーズを追加し、pr-cleanup の処理を completed フェーズに統合する。

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発（SDD）を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] 新フェーズ「review」（仮称）を追加し、PR 作成後のレビュー待ち状態を表現できること
- [ ] フェーズと GitHub Projects ステータスのマッピングが以下の通りであること:
  - requirements → Todo
  - design → In Progress
  - implementation → In Progress
  - review（新規） → In Review
  - completed → Done
- [ ] completed フェーズへの遷移時に、従来の pr-cleanup の処理（ブランチ削除、DB 更新）が実行されること

### 機能要件

- [ ] `/cft:spec-phase <id> review` コマンドで review フェーズに遷移できること
- [ ] review フェーズでは従来の completed フェーズの処理（Issue クローズ以外）が実行されること
- [ ] `/cft:spec-phase <id> completed` コマンドで従来の pr-cleanup の処理が実行されること
- [ ] `/cft:pr-cleanup` コマンドは廃止または completed フェーズへのエイリアスとすること
- [ ] フェーズ省略形（rev, r など）をサポートすること

### 非機能要件

- [ ] 既存の仕様書との後方互換性を維持すること
- [ ] フェーズ遷移のバリデーションルールを更新すること

---

## 4. 制約条件

- フェーズ定義は `src/core/database/schema.ts` の `SpecPhase` 型に追加が必要
- GitHub Projects ステータスマッピングは `src/core/config/github-status-config.ts` で管理
- イベント駆動アーキテクチャ（EventBus）を維持すること
- 既存の 4 段階ステータス（Todo, In Progress, In Review, Done）を前提とする

---

## 5. 依存関係

### 関連ファイル

- `src/core/database/schema.ts` - SpecPhase 型定義
- `src/core/config/github-status-config.ts` - ステータスマッピング設定
- `src/core/workflow/phase-mapping.ts` - フェーズ省略形マッピング
- `src/commands/spec/phase.ts` - spec-phase コマンド実装
- `src/core/workflow/github-integration.ts` - GitHub 連携イベントハンドラー
- `src/integrations/github/pr-cleanup.ts` - PR クリーンアップ処理
- `src/commands/github/pr-cleanup.ts` - pr-cleanup コマンド
- `src/core/workflow/phase-transition-validator.ts` - フェーズ遷移バリデーション

---

## 6. 参考情報

- 現在のフェーズ定義: `'requirements' | 'design' | 'tasks' | 'implementation' | 'completed'`
- tasks フェーズは非推奨（後方互換性のため残存）
- フェーズ→ステータスマッピングは `config.json` でカスタマイズ可能
