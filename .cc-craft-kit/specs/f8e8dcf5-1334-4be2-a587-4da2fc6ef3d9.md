# 構成見直し

**仕様書 ID:** f8e8dcf5-1334-4be2-a587-4da2fc6ef3d9
**フェーズ:** requirements
**作成日時:** 2025/12/05 12:00:00
**更新日時:** 2025/12/05 12:00:00

---

## 1. 背景と目的

### 背景

kiro や cc-sdd  と同様に、カスタムスラッシュコマンド、スキル、サブエージェントのみで構成させたい

### 目的

cc-craft-kit のアーキテクチャを見直し、TypeScript スクリプト層を最小化して、kiro や cc-sdd と同様にカスタムスラッシュコマンド（.md）、スキル（.md）、サブエージェント（.md）のみで構成されるプロンプトファーストなツールキットに再構築する。

---

## 2. 対象ユーザー

- cc-craft-kit を使用する開発者
- Claude Code でプロンプトファースト開発を実践したいユーザー
- 仕様駆動開発（SDD）ワークフローを採用するチーム

---

## 3. 受け入れ基準

### 必須要件

- [ ] 現在の 43 個の CLI コマンド（src/commands/**/*.ts）を精査し、必須なもの以外を削除またはプロンプト層に統合
- [ ] DB 操作（Kysely）、GitHub API（Octokit）、EventBus の 3 要素は最小スクリプトとして維持
- [ ] スラッシュコマンド（24個）、スキル（4個）、サブエージェント（3個）でほぼ全機能をカバー

### 機能要件

- [ ] TypeScript サブエージェント実装（6個）をマークダウン定義に移行検討
- [ ] TypeScript スキル実装（4個）をマークダウン定義に移行検討
- [ ] 出力フォーマット処理（utils/output.ts）をプロンプト層に統合
- [ ] ステートレスな CLI コマンドを削除し、処理をスラッシュコマンド内に直接記述

### 非機能要件

- [ ] npm run sync:dogfood の同期対象を削減し、ビルドプロセスを簡素化
- [ ] コードベースの総行数を現在の 6,693 行から大幅に削減
- [ ] 新規機能追加時は原則としてマークダウン定義のみで完結

---

## 4. 制約条件

### 技術的制約

- **DB 層（Kysely）**: 25+ のコマンドが DB 操作を含むため、完全なプロンプト化は不可能。最小スクリプトとして維持が必須
- **GitHub API（Octokit）**: 認証・エラーハンドリングが複雑なため、スクリプト層で継続
- **EventBus（イベント駆動）**: フェーズ移行時の自動処理に必要。15+ のハンドラーが登録済み
- **ファイル監視（Chokidar）**: watch.ts でバックグラウンド実行が必要

### 設計原則

- プロンプトファースト原則を厳格に適用
- スクリプトは「DB操作」「外部API」「イベント駆動」「ファイル監視」の 4 用途に限定

---

## 5. 依存関係

### 削除不可能なコア依存

- `src/core/database/**` - Kysely によるDB接続・スキーマ・マイグレーション
- `src/core/workflow/event-bus.ts` - イベント駆動エンジン
- `src/integrations/github/**` - Octokit による GitHub 連携

### 削除候補の依存

- `src/core/subagents/impl/**` - TypeScript サブエージェント実装（マークダウン化検討）
- `src/core/skills/impl/**` - TypeScript スキル実装（マークダウン化検討）
- `src/commands/utils/output.ts` - 出力フォーマット（プロンプト層に移行）

### 参照先ツール

- kiro: https://kiro.dev （Amazon の仕様駆動開発ツール）
- cc-sdd: cc-craft-kit の前身プロジェクト

---

## 6. 参考情報

- `agent_docs/PROMPT_FIRST_PRINCIPLE.md` - プロンプトファースト原則の詳細
- `docs/ARCHITECTURE.md` - 現在のアーキテクチャ概要
- `src/slash-commands/spec-create.md` - 45ステップの自動実行フロー例（参考実装）
- `src/skills/pr-creator/SKILL.md` - スキル定義の参考例
- `src/agents/test-generator.md` - サブエージェント定義の参考例（293行）
