# /cft:spec-phase コマンドの引数に GitHub Issue の指定も可とする

**仕様書 ID:** ca338052-941d-4a47-81da-f757558d629c
**フェーズ:** design
**作成日時:** 2025/11/28 17:30:00
**更新日時:** 2025/11/28 17:42:00

---

## 1. 背景と目的

### 背景

現在の `/cft:spec-phase` コマンドは、仕様書 ID（UUID の先頭 8 文字以上）のみを引数として受け付ける。しかし、GitHub Issue と連携した開発フローでは、Issue 番号（例: #42）の方が直感的に参照しやすいケースが多い。特に GitHub の Issue 一覧や通知から作業を開始する場合、Issue 番号から仕様書を特定してフェーズを変更したいニーズがある。

### 目的

`/cft:spec-phase` コマンドの第一引数に GitHub Issue 番号（`#123` または `123` 形式）を指定可能にし、仕様書 ID と GitHub Issue 番号のどちらでもフェーズ変更操作を行えるようにする。

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発を行う開発者。特に GitHub Issue と仕様書を連携させて開発フローを管理しているユーザー。

---

## 3. 受け入れ基準

### 必須要件

- [ ] `/cft:spec-phase #42 design` 形式で GitHub Issue 番号を指定してフェーズ変更ができること
- [ ] `/cft:spec-phase 42 design` 形式（# なし）でも GitHub Issue 番号として認識されること
- [ ] 既存の仕様書 ID 指定（`/cft:spec-phase f6621295 design`）は引き続き動作すること

### 機能要件

- [ ] GitHub Issue 番号と仕様書 ID の引数パターンを自動判別すること
- [ ] 指定された GitHub Issue 番号に紐付く仕様書が存在しない場合、適切なエラーメッセージを表示すること
- [ ] 同一 GitHub Issue に複数の仕様書が紐付いている場合のエラーハンドリングがあること

### 非機能要件

- [ ] GitHub Issue 番号からの仕様書検索は既存のインデックスを活用し、高速に動作すること
- [ ] 後方互換性を維持し、既存のスクリプトやワークフローに影響を与えないこと

---

## 4. 制約条件

- `github_sync` テーブルの既存構造を活用する（新規テーブル作成は不要）
- `github_sync.issue_number` または `github_sync.github_number` フィールドに index があり、高速検索が可能
- GitHub API 呼び出しは不要（ローカル DB のみで完結）

---

## 5. 依存関係

- `src/commands/spec/resolve-id.ts`: 仕様書 ID 解決ロジックの拡張が必要
- `src/commands/utils/validation.ts`: GitHub Issue 番号の検証関数追加
- `.cc-craft-kit/slash-commands/spec-phase.md`: コマンド仕様書の更新
- `github_sync` テーブル: 仕様書と GitHub Issue の関連付けデータ

---

## 6. 参考情報

- 現在の引数仕様: `argument-hint: "<spec-id> <phase>"`
- 拡張後の引数仕様案: `argument-hint: "<spec-id|#issue-number> <phase>"`
- 関連テーブル: `specs`, `github_sync`
