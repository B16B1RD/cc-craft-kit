# コマンドの棚卸

**仕様書 ID:** 7653d43a-6d88-420a-95e3-e11a9f216097
**フェーズ:** design
**作成日時:** 2025/11/28 00:00:00
**更新日時:** 2025/11/28 11:51:36

---

## 1. 背景と目的

### 背景

いま一度コマンドを整理したい。実際の利用では限られたコマンドしか使用していない。改めて、要不要を整理する必要がある。

### 目的

現在 42 個存在するスラッシュコマンドを整理・統合し、実際の開発フローで頻繁に使用されるコマンドのみを残すことで、学習コストの削減とメンテナンス性の向上を実現する。

---

## 2. 対象ユーザー

cc-craft-kit を使用して仕様駆動開発（SDD）を行う開発者

---

## 3. 受け入れ基準

### 必須要件

- [ ] コマンド数を 42 個から 30 個以下に削減する
- [ ] 既存ワークフロー（仕様書作成→タスク管理→完了）が破壊されない
- [ ] 削除・統合されたコマンドの代替手段がドキュメント化される

### 機能要件

- [ ] 品質管理コマンド（quality-init/check/generate）を統合する
- [ ] タスク管理コマンド（task-list/start/update/done/split）を統合する
- [ ] GitHub 連携コマンド（github-init/sync/issue-create/project-add）を統合する
- [ ] 知識記録コマンド（knowledge-progress/error/tip）を統合する
- [ ] 使用頻度の低いコマンド（watch, db-info, skill-list, agent-list）を削除または内部コマンドに降格する

### 非機能要件

- [ ] コマンドのヘルプ表示が統一されたフォーマットに準拠する
- [ ] コマンド名が直感的で一貫した命名規則に従う

---

## 4. 制約条件

- CLAUDE.md のプロンプトファースト原則に従い、スクリプト実装は最小限に抑える
- 既存のスラッシュコマンド定義形式（Markdown）を維持する
- データベーススキーマの変更は行わない（後方互換性を維持）
- セッション管理コマンド（session-start/end）は最近追加されたため、統合対象から除外する

---

## 5. 依存関係

- `src/slash-commands/**/*.md` - 既存スラッシュコマンド定義
- `src/commands/**/*.ts` - TypeScript 実装
- `.cc-craft-kit/slash-commands/**/*.md` - 同期先コマンド定義
- `npm run sync:dogfood` - ソースコード同期スクリプト

---

## 6. 参考情報

- コードベース解析レポート（Explore サブエージェント出力）
- 現在のコマンド数: 42 個
- 参照回数が多いコマンド: spec-phase (23回), spec-get (16回), spec-list (15回)
- 削除候補: watch, db-info, skill-list, agent-list
- 統合候補: quality-*, task-*, github-*, knowledge-*

---

## 7. 設計詳細

### 7.1 アーキテクチャ設計

#### 全体構成

```
現在のコマンド構成（42 個）
├── 仕様書管理（7 個）: spec-*
├── タスク管理（6 個）: task-*
├── GitHub 連携（5 個）: github-*
├── 品質管理（7 個）: quality-*, lint-check, test-generate, etc.
├── 知識記録（3 個）: knowledge-*
├── セッション管理（2 個）: session-*
├── 内部管理（6 個）: init, status, watch, db-info, sync-*
└── スキル・エージェント（5 個）: skill-*, agent-*

↓ 統合・削除後の構成（25 個以下）

新しいコマンド構成
├── 仕様書管理（6 個）: spec-* [1 個削減]
├── タスク管理（3 個）: task-* [3 個統合]
├── GitHub 連携（3 個）: github-* [2 個統合]
├── 品質管理（5 個）: quality-*, lint-check, etc. [2 個統合]
├── 知識記録（1 個）: knowledge [3 個統合]
├── セッション管理（2 個）: session-* [維持]
├── 内部管理（3 個）: init, status, sync [3 個削減]
└── スキル・エージェント（2 個）: custom-tools [3 個統合]
```

#### 設計方針

1. **マスターコマンド化**: 関連する複数コマンドをサブコマンドパターンで統合
2. **階層化**: `/cft:category:action` 形式で直感的な命名
3. **削除より統合優先**: 機能は維持しつつコマンド数を削減
4. **内部コマンド降格**: 日常使用しないコマンドは TS 関数として内部化

### 7.2 実装方針

#### 統合対象コマンド

| 統合先 | 統合元 | 統合方法 |
|-------|-------|---------|
| `/cft:task` | task-list, task-start, task-update, task-done, task-split, test-report | サブコマンド化 |
| `/cft:knowledge` | knowledge-progress, knowledge-error, knowledge-tip | サブコマンド化 |
| `/cft:quality` | quality-init, quality-check, quality-generate | サブコマンド化 |
| `/cft:sync` | sync-check, sync-repair | サブコマンド化 |
| `/cft:custom-tools` | skill-list, skill-create, agent-list, agent-create | サブコマンド化 |

#### 削除対象コマンド

| コマンド | 削除理由 | 代替手段 |
|---------|---------|---------|
| `/cft:watch` | 使用頻度低、ファイル監視は IDE で代替可能 | 手動で `npx tsx` 実行 |
| `/cft:db-info` | 診断用途のみ、日常使用なし | `/cft:status --verbose` に統合 |
| `/cft:migrate-tasks-to-design` | tasks フェーズ非推奨に伴い不要 | spec-phase で自動対応 |
| `/cft:github-project-add` | 使用頻度低、手動で `gh` コマンド実行可能 | `gh project item-add` |

#### 修正対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `src/slash-commands/task-list.md` | 削除（task.md に統合） |
| `src/slash-commands/task-start.md` | 削除（task.md に統合） |
| `src/slash-commands/task-update.md` | 削除（task.md に統合） |
| `src/slash-commands/task-done.md` | 削除（task.md に統合） |
| `src/slash-commands/task-split.md` | 削除（task.md に統合） |
| `src/slash-commands/test-report.md` | 削除（task.md に統合） |
| `src/slash-commands/task.md` | 新規作成（統合コマンド） |
| `src/slash-commands/knowledge-progress.md` | 削除（knowledge.md に統合） |
| `src/slash-commands/knowledge-error.md` | 削除（knowledge.md に統合） |
| `src/slash-commands/knowledge-tip.md` | 削除（knowledge.md に統合） |
| `src/slash-commands/knowledge.md` | 新規作成（統合コマンド） |
| `src/slash-commands/quality-init.md` | 削除（quality.md に統合） |
| `src/slash-commands/quality-check.md` | 削除（quality.md に統合） |
| `src/slash-commands/quality-generate.md` | 削除（quality.md に統合） |
| `src/slash-commands/quality.md` | 新規作成（統合コマンド） |
| `src/slash-commands/sync-check.md` | 削除（sync.md に統合） |
| `src/slash-commands/sync-repair.md` | 削除（sync.md に統合） |
| `src/slash-commands/sync.md` | 新規作成（統合コマンド） |
| `src/slash-commands/skill-list.md` | 削除（custom-tools.md に統合） |
| `src/slash-commands/skill-create.md` | 削除（custom-tools.md に統合） |
| `src/slash-commands/agent-list.md` | 削除（custom-tools.md に統合） |
| `src/slash-commands/agent-create.md` | 削除（custom-tools.md に統合） |
| `src/slash-commands/custom-tools.md` | 新規作成（統合コマンド） |
| `src/slash-commands/watch.md` | 削除 |
| `src/slash-commands/db-info.md` | 削除（status.md に機能統合） |
| `src/slash-commands/migrate-tasks-to-design.md` | 削除 |
| `src/slash-commands/github-project-add.md` | 削除 |
| `src/slash-commands/status.md` | 更新（--verbose オプション追加） |

### 7.3 機能マッピング

| 旧コマンド | 新コマンド | 変更点 |
|-----------|-----------|--------|
| `/cft:task-list <spec-id>` | `/cft:task list <spec-id>` | サブコマンド形式に変更 |
| `/cft:task-start <issue>` | `/cft:task start <issue>` | サブコマンド形式に変更 |
| `/cft:task-update <spec-id> <task> <status>` | `/cft:task update <spec-id> <task> <status>` | サブコマンド形式に変更 |
| `/cft:task-done <issue>` | `/cft:task done <issue>` | サブコマンド形式に変更 |
| `/cft:task-split <spec-id> <task>` | `/cft:task split <spec-id> <task>` | サブコマンド形式に変更 |
| `/cft:test-report <spec-id>` | `/cft:task report <spec-id>` | task 統合、名前変更 |
| `/cft:knowledge-progress <spec-id> <msg>` | `/cft:knowledge progress <spec-id> <msg>` | サブコマンド形式に変更 |
| `/cft:knowledge-error <spec-id> <err> <sol>` | `/cft:knowledge error <spec-id> <err> <sol>` | サブコマンド形式に変更 |
| `/cft:knowledge-tip <spec-id> <cat> <tip>` | `/cft:knowledge tip <spec-id> <cat> <tip>` | サブコマンド形式に変更 |
| `/cft:quality-init` | `/cft:quality init` | サブコマンド形式に変更 |
| `/cft:quality-check` | `/cft:quality check` | サブコマンド形式に変更 |
| `/cft:quality-generate` | `/cft:quality generate` | サブコマンド形式に変更 |
| `/cft:sync-check` | `/cft:sync check` | サブコマンド形式に変更 |
| `/cft:sync-repair` | `/cft:sync repair` | サブコマンド形式に変更 |
| `/cft:skill-list` | `/cft:custom-tools skill list` | カテゴリ統合 |
| `/cft:skill-create` | `/cft:custom-tools skill create` | カテゴリ統合 |
| `/cft:agent-list` | `/cft:custom-tools agent list` | カテゴリ統合 |
| `/cft:agent-create` | `/cft:custom-tools agent create` | カテゴリ統合 |
| `/cft:db-info` | `/cft:status --verbose` | status に統合 |
| `/cft:watch` | 削除 | 手動実行に変更 |
| `/cft:migrate-tasks-to-design` | 削除 | spec-phase で自動対応 |
| `/cft:github-project-add` | 削除 | `gh` コマンドで代替 |

### 7.4 テスト戦略

| テスト対象 | テスト内容 | 検証方法 |
|----------|----------|---------|
| 統合コマンド（task.md） | サブコマンド分岐が正しく動作 | 手動テスト（各サブコマンド実行） |
| 統合コマンド（knowledge.md） | 各記録タイプが GitHub Issue に反映 | 手動テスト + GitHub Issue 確認 |
| 統合コマンド（quality.md） | 品質チェックフローが維持 | 手動テスト（init → check → generate） |
| 統合コマンド（sync.md） | 整合性チェック・修復が動作 | 手動テスト（意図的に不整合を作成） |
| 統合コマンド（custom-tools.md） | スキル/エージェント CRUD | 手動テスト（作成・一覧表示） |
| 削除コマンド | 削除後もワークフローが動作 | E2E テスト（仕様書作成→完了フロー） |
| status --verbose | DB 情報が出力される | 手動テスト |

### 7.5 移行計画

#### Phase 1: タスク管理コマンド統合

1. `src/slash-commands/task.md` を新規作成（サブコマンド分岐ロジック実装）
2. 既存の task-list, task-start, task-update, task-done, task-split, test-report を task.md から呼び出し
3. 動作確認後、旧コマンドファイルを削除

#### Phase 2: 知識記録コマンド統合

1. `src/slash-commands/knowledge.md` を新規作成
2. 既存の knowledge-progress, knowledge-error, knowledge-tip を knowledge.md から呼び出し
3. 動作確認後、旧コマンドファイルを削除

#### Phase 3: 品質管理コマンド統合

1. `src/slash-commands/quality.md` を新規作成
2. 既存の quality-init, quality-check, quality-generate を quality.md から呼び出し
3. 動作確認後、旧コマンドファイルを削除

#### Phase 4: 同期コマンド統合

1. `src/slash-commands/sync.md` を新規作成
2. 既存の sync-check, sync-repair を sync.md から呼び出し
3. 動作確認後、旧コマンドファイルを削除

#### Phase 5: スキル・エージェントコマンド統合

1. `src/slash-commands/custom-tools.md` を新規作成
2. 既存の skill-list, skill-create, agent-list, agent-create を custom-tools.md から呼び出し
3. 動作確認後、旧コマンドファイルを削除

#### Phase 6: 不要コマンド削除・status 拡張

1. watch.md, db-info.md, migrate-tasks-to-design.md, github-project-add.md を削除
2. status.md に `--verbose` オプションを追加（DB 情報表示）
3. `npm run sync:dogfood` で同期
4. 最終動作確認

---

## 8. 実装タスクリスト

### Phase 1: タスク管理コマンド統合

- [ ] `src/slash-commands/task.md` を新規作成（サブコマンドルーター実装）
- [ ] task.md にサブコマンド分岐ロジックを実装（list/start/update/done/split/report）
- [ ] 動作確認: `/cft:task list`, `/cft:task start`, `/cft:task done` をテスト
- [ ] 旧コマンドファイル削除（task-list.md, task-start.md, task-update.md, task-done.md, task-split.md, test-report.md）

### Phase 2: 知識記録コマンド統合

- [ ] `src/slash-commands/knowledge.md` を新規作成（サブコマンドルーター実装）
- [ ] knowledge.md にサブコマンド分岐ロジックを実装（progress/error/tip）
- [ ] 動作確認: `/cft:knowledge progress`, `/cft:knowledge error`, `/cft:knowledge tip` をテスト
- [ ] 旧コマンドファイル削除（knowledge-progress.md, knowledge-error.md, knowledge-tip.md）

### Phase 3: 品質管理コマンド統合

- [ ] `src/slash-commands/quality.md` を新規作成（サブコマンドルーター実装）
- [ ] quality.md にサブコマンド分岐ロジックを実装（init/check/generate）
- [ ] 動作確認: `/cft:quality init`, `/cft:quality check`, `/cft:quality generate` をテスト
- [ ] 旧コマンドファイル削除（quality-init.md, quality-check.md, quality-generate.md）

### Phase 4: 同期コマンド統合

- [ ] `src/slash-commands/sync.md` を新規作成（サブコマンドルーター実装）
- [ ] sync.md にサブコマンド分岐ロジックを実装（check/repair）
- [ ] 動作確認: `/cft:sync check`, `/cft:sync repair` をテスト
- [ ] 旧コマンドファイル削除（sync-check.md, sync-repair.md）

### Phase 5: スキル・エージェントコマンド統合

- [ ] `src/slash-commands/custom-tools.md` を新規作成（サブコマンドルーター実装）
- [ ] custom-tools.md にサブコマンド分岐ロジックを実装（skill list/create, agent list/create）
- [ ] 動作確認: `/cft:custom-tools skill list`, `/cft:custom-tools agent create` をテスト
- [ ] 旧コマンドファイル削除（skill-list.md, skill-create.md, agent-list.md, agent-create.md）

### Phase 6: 不要コマンド削除・status 拡張

- [ ] watch.md を削除
- [ ] db-info.md を削除
- [ ] migrate-tasks-to-design.md を削除
- [ ] github-project-add.md を削除
- [ ] status.md に `--verbose` オプションを追加（DB 情報表示機能）
- [ ] `npm run sync:dogfood` で同期
- [ ] 最終動作確認（仕様書作成→タスク管理→完了の E2E フロー）
- [ ] コマンド数が 30 個以下であることを確認
