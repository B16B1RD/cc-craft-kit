# textlint エラーの完全解決

**仕様書 ID:** ff13d208-7fa5-4e85-a7f2-7ba72fa6ba8c
**フェーズ:** completed
**作成日時:** 2025/11/19 17:49:52
**更新日時:** 2025/11/19 18:13:32

---

## 1. 背景と目的

### 背景

#### 現状の問題

cc-craft-kit プロジェクトでは、マークダウン形式の技術文書（仕様書、ドキュメント）に対して textlint による品質チェックを実施していますが、現在以下の深刻な問題が発生しています。

- **大量のエラー**: 合計 1,629 個のエラー（896 エラー + 733 警告）が検出されている
- **CI の不安定性**: textlint チェック失敗により CI/CD パイプラインが断続的に失敗
- **文書品質のばらつき**: 統一された品質基準が守られていない
- **技術的負債の蓄積**: 新規仕様書作成時にもエラーが継続的に発生

#### 影響範囲

- **開発効率の低下**: CI 失敗により PR マージが遅延
- **品質保証の欠如**: エラーを含む文書が本番環境に混入
- **新規参加者の混乱**: 文書品質基準が不明確で、貢献しづらい

#### 解決の必要性

本プロジェクトは仕様駆動開発（SDD）を標榜しており、仕様書の品質が開発全体の品質に直結します。textlint エラーをゼロにすることは、プロジェクトの信頼性向上に不可欠です。

### 目的

本仕様は、cc-craft-kit プロジェクト全体のマークダウン文書品質を向上させ、CI/CD パイプラインの安定性を確保することを目的とします。具体的には以下を達成します。

1. **textlint エラーをゼロにする**: 現在の 1,629 個のエラー（896 エラー、733 警告）をすべて解決します。
2. **CI 時の失敗を防止**: textlint チェックで CI が失敗しないようにします。
3. **文書品質の標準化**: 日本語技術文書としての品質基準を確立します。
4. **継続的な品質維持**: 今後の文書作成時にエラーが発生しないようにガイドラインを整備します。

---

## 2. 対象ユーザー

### 主要対象ユーザー
- **cc-craft-kit 開発者**: 仕様書やドキュメントを作成・編集するすべての開発者
- **CI/CD パイプライン**: 自動チェックプロセスの安定稼働を必要とする運用チーム

### 副次的対象ユーザー
- **新規参加者**: 文書品質基準を理解し、プロジェクトに貢献する開発者
- **ドキュメント読者**: 高品質で読みやすい技術文書を必要とするすべてのユーザー

---

## 3. 受け入れ基準

### 必須要件

- [ ] `.cc-craft-kit/specs/**/*.md` 内の全 54 個の仕様書ファイルで textlint エラーが 0 個になること
- [ ] `npm run textlint` コマンドの実行結果が「0 errors, 0 warnings」を返すこと
- [ ] CI パイプラインの textlint ステップが成功すること（exit code 0）
- [ ] 自動修正可能な 444 個のエラーがすべて修正されていること

### 機能要件

- [ ] 以下のエラーカテゴリがすべて解決されていること
  - 句点（。）の欠落エラー
  - 冗長表現の使用
  - 「である調」と「ですます調」の混在
  - 漢字の連続使用（7 文字以上）
  - カンマ（、）の多用（1 文に 4 個以上）
- [ ] `.textlintrc.json` の設定に違反する箇所が存在しないこと
- [ ] 手動修正が必要なエラー（約 1,185 個）が適切に対応されていること
- [ ] コードブロック内の textlint エラーが適切に除外されていること

### 非機能要件

- [ ] 修正後も文書の技術的正確性が保たれていること
- [ ] 文書の可読性が向上または維持されていること
- [ ] 修正履歴が Git コミットログで追跡可能であること
- [ ] 修正作業のガイドライン文書が作成されていること
- [ ] 今後のエラー発生を防ぐためのチェックリストが整備されていること

---

## 4. 制約条件

### 技術的制約

- **textlint バージョン**: 現在のプロジェクト依存関係に固定（package.json 参照）
- **textlint ルールセット**: 以下のプリセットを使用
  - `preset-ja-technical-writing`: 日本語技術文書の基本ルール
  - `@textlint-ja/preset-ai-writing`: AI 生成文書の品質チェック
  - `preset-ja-spacing`: 日英文字間スペーシング
- **対象ファイル形式**: マークダウン（.md）のみ
- **除外対象**: `node_modules/`, `.git/`, `dist/` 配下のファイル

### 作業上の制約

- **破壊的変更の禁止**: 文書の技術的内容を変更してはならない
- **段階的修正**: 一度にすべてを修正せず、ファイル単位またはエラーカテゴリ単位で進める
- **レビュープロセス**: 自動修正後は必ず目視確認を行うこと
- **時間制約**: 完了期限は設定しないが、継続的に進捗を記録すること

### 前提条件

- `.textlintrc.json` の設定は変更しない（既存ルールに準拠）
- 自動修正ツール（`npm run textlint:fix`）を優先的に使用
- 手動修正が必要な箇所は、理由をコメントで記録

---

## 5. 依存関係

### 技術的依存関係

- **textlint CLI**: 文書チェックエンジン
- **textlint プリセット**:
  - `textlint-rule-preset-ja-technical-writing`
  - `@textlint-ja/preset-ai-writing`
  - `textlint-rule-preset-ja-spacing`
- **npm スクリプト**:
  - `npm run textlint`: エラーチェック実行
  - `npm run textlint:fix`: 自動修正実行
- **CI/CD パイプライン**: GitHub Actions ワークフロー

### 関連仕様

- **CLAUDE.md**: プロジェクトのコーディング規約とドキュメント方針
- **ARCHITECTURE.md**: 技術文書の構造ガイドライン
- **既存の仕様書テンプレート**: `.cc-craft-kit/specs/` 内のすべての仕様書が対象

### 外部リソース

- [textlint 公式ドキュメント](https://textlint.github.io/)
- [preset-ja-technical-writing ルール一覧](https://github.com/textlint-ja/textlint-rule-preset-ja-technical-writing)
- [AI writing preset ガイドライン](https://github.com/textlint-ja/textlint-rule-preset-ai-writing)

---

## 6. 参考情報

### エラー状況の詳細

- **総エラー数**: 1,629 個（896 エラー + 733 警告）
- **対象ファイル数**: 54 個の仕様書ファイル（`.cc-craft-kit/specs/**/*.md`）
- **自動修正可能**: 444 個のエラー
- **手動修正必要**: 約 1,185 個のエラー

### 主なエラーカテゴリと修正方法

1. **句点の欠落**:
   - エラー例:「要件を満たす必要がある」→「要件を満たす必要があります。」
   - 自動修正: 可能

2. **冗長表現**:
   - エラー例:「できます」→「できます」
   - 自動修正: 部分的に可能

3. **である/ですます調の混在**:
   - エラー例: 文書内で統一されていない
   - 自動修正: 不可（手動で統一）

4. **漢字の連続**:
   - エラー例:「仕様書作成時」→「仕様書の作成時」
   - 自動修正: 部分的に可能

5. **カンマの多用**:
   - エラー例: 1 文に 4 個以上のカンマがある
   - 自動修正: 不可（文を分割）

### 作業手順

```bash
# 1. 現在のエラー状況を確認
npm run textlint

# 2. 自動修正を実行
npm run textlint:fix

# 3. 残存エラーを確認
npm run textlint

# 4. 手動修正が必要な箇所を特定
npm run textlint -- --format json > textlint-errors.json

# 5. ファイル単位で修正
npm run textlint -- .cc-craft-kit/specs/ff13d208-7fa5-4e85-a7f2-7ba72fa6ba8c.md

# 6. CI チェック
git add . && git commit -m "fix: textlint エラーを修正"
```

### 関連ドキュメント

- [cc-craft-kit プロジェクト README](../../README.md)
- [開発ガイドライン](../../CLAUDE.md)
- [textlint 設定ファイル](../../.textlintrc.json)

---

## 7. リスク管理

### 特定されたリスク

| リスク | 影響度 | 発生確率 | 対策 |
|---|---|---|---|
| 自動修正による文意の変更 | 高 | 中 | 自動修正後の目視確認を必須化 |
| 手動修正時の技術的誤り | 高 | 低 | 専門用語は元の表記を維持 |
| 作業時間の超過 | 中 | 高 | フェーズごとに進捗確認、必要に応じて分割 |
| CI パイプラインの失敗継続 | 高 | 低 | 各フェーズ終了時に CI チェック実行 |
| 新規エラーの混入 | 中 | 中 | pre-commit フックの導入を検討 |

### 緊急時対応

- **文書破損が発生した場合**: Git で `git revert` を実行し、該当コミットをロールバック
- **作業が長期化した場合**: フェーズ単位でブランチを分け、段階的にマージ
- **CI が修正後も失敗する場合**: `.textlintrc.json` の設定見直しを検討

---

## 8. 実装タスクリスト

### フェーズ 1: 自動修正（推定: 1-2 時間）

- [ ] `npm run textlint:fix` で自動修正可能な 444 個のエラーを一括修正
- [ ] 自動修正後のファイルを目視確認（破壊的変更がないか）
- [ ] 修正結果を Git コミット

### フェーズ 2: エラーカテゴリ別の手動修正（推定: 8-12 時間）

#### 句点の欠落（推定: 100-150 箇所）
- [ ] 仕様書ファイルを 10 個ずつバッチ処理
- [ ] 文末に適切な句点を追加

#### 冗長表現の削除（推定: 80-120 箇所）
- [ ] 「できる」→「できる」等の置換
- [ ] 文意が変わらないことを確認

#### である/ですます調の統一（推定: 200-300 箇所）
- [ ] プロジェクト方針を確認（CLAUDE.md 参照）
- [ ] すべての仕様書を「ですます調」に統一

#### 漢字連続の解消（推定: 150-200 箇所）
- [ ] 7 文字以上の漢字連続を特定
- [ ] 適切な助詞を挿入

#### カンマの多用の解消（推定: 100-150 箇所）
- [ ] 1 文に 4 個以上のカンマがある箇所を特定
- [ ] 文を複数に分割して可読性を向上

### フェーズ 3: 検証と継続的品質保証（推定: 2-3 時間）

- [ ] `npm run textlint` でエラーゼロを確認
- [ ] CI パイプラインでの成功を確認
- [ ] 修正ガイドラインドキュメントを作成
- [ ] pre-commit フックの設定を検討
- [ ] 最終レビューと完了報告

### 進捗管理

- 総推定作業時間: 11-17 時間
- 推奨進行方法: 1 日 2-3 時間ずつ、5-7 日間で完了
- 進捗記録: `/cft:knowledge-progress` コマンドで GitHub Issue に記録
