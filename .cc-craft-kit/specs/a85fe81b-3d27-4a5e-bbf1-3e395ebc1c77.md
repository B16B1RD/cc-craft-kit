# CLAUDE.md で開発キットをコントロールしてはならない

**仕様書 ID:** a85fe81b-3d27-4a5e-bbf1-3e395ebc1c77
**フェーズ:** implementation
**作成日時:** 2025/11/22 23:50:15
**更新日時:** 2025/11/23 00:05:06

---

## 1. 背景と目的

### 背景

CLAUDE.md は本来の役割の内容にしてほしい。現在は、開発キットの動作について記述しているこれらはすべて削除してください。CLAUDE.md はこのリポジトリの開発に関わることのみ記述すること。開発キット自身は、CLAUDE.md によらずカスタムスラッシュコマンド、スキル、サブエージェントのみで自立して動作する仕組みでなければならない。

### 目的

CLAUDE.md を本来の役割（プロジェクト開発ガイド）に限定し、開発キットの動作制御に関する記述を全て削除する。開発キット自身は、カスタムスラッシュコマンド、スキル、サブエージェントのみで自立して動作する仕組みに移行する。

---

## 2. 対象ユーザー

- cc-craft-kit の開発者
- cc-craft-kit を使用するプロジェクト開発者
- Claude Code（AI エージェント）

---

## 3. 受け入れ基準

### 必須要件

- [ ] CLAUDE.md から「cc-craft-kit スラッシュコマンドの自動処理」セクション全体を削除する
- [ ] 削除した動作仕様は、対応するスラッシュコマンドファイル（`.claude/commands/cc-craft-kit/*.md`）に移動する
- [ ] CLAUDE.md には cc-craft-kit プロジェクト自体の開発に関する情報のみを残す

### 機能要件

- [ ] `/cft:spec-phase` の自動処理仕様を `src/slash-commands/spec-phase.md` に移動
- [ ] ブランチ作成に関する仕様を `src/slash-commands/spec-create.md` に統合（既に記載済みか確認）
- [ ] CLAUDE.md のアーキテクチャ、イベント駆動、データベーススキーマなどの技術情報は残す
- [ ] 開発者向けの「よく使うコマンド」「コーディング規約」「トラブルシューティング」は残す

### 非機能要件

- [ ] CLAUDE.md のサイズを削減し、Claude Code の初期読み込みコンテキストを節約する
- [ ] 開発キットの動作仕様が適切な場所に配置され、保守性が向上する
- [ ] 既存の動作に影響を与えない（スラッシュコマンドは引き続き正常に機能する）

---

## 4. 制約条件

- CLAUDE.md は cc-craft-kit プロジェクト自体の開発に関する情報のみを記述する
- スラッシュコマンドファイル（`src/slash-commands/*.md`）に開発キットの動作仕様を記述する
- 既存のスラッシュコマンドの動作を変更しない

---

## 5. 依存関係

- `CLAUDE.md` - 編集対象
- `src/slash-commands/spec-phase.md` - 動作仕様の移動先
- `src/slash-commands/spec-create.md` - ブランチ作成仕様の確認

---

## 4. 設計方針

### アーキテクチャ

**責任分離の原則:**

- **CLAUDE.md**: cc-craft-kit プロジェクト自体の開発ガイド（アーキテクチャ、コーディング規約、トラブルシューティング）
- **スラッシュコマンドファイル**: 開発キットの動作仕様（自動処理フロー、引数仕様、実行内容）
- **コマンド実装**: 実際のビジネスロジック（TypeScript）

### データフロー

```text
┌────────────────────────────────────┐
│ Claude Code（AI エージェント）      │
├────────────────────────────────────┤
│ 1. CLAUDE.md を読み込む             │
│    - プロジェクト開発ガイド         │
│    - アーキテクチャ理解             │
│    - コーディング規約               │
├────────────────────────────────────┤
│ 2. スラッシュコマンド実行           │
│    /cft:spec-phase <spec-id> tasks │
├────────────────────────────────────┤
│ 3. スラッシュコマンドファイル展開   │
│    .claude/commands/cc-craft-kit/  │
│    spec-phase.md                   │
│    - フェーズ移行後の自動処理       │
│    - tasks フェーズの動作仕様       │
│    - implementation フェーズの仕様  │
├────────────────────────────────────┤
│ 4. コマンド実装実行                 │
│    npx tsx .cc-craft-kit/commands/ │
│    spec/phase.ts                   │
│    - データベース更新               │
│    - ファイル更新                   │
│    - イベント発火                   │
├────────────────────────────────────┤
│ 5. 自動処理の実行                   │
│    - Read ツールで仕様書読み込み    │
│    - TodoWrite でタスクリスト作成   │
│    - Edit で仕様書更新              │
└────────────────────────────────────┘
```

### コンテキスト使用量の最適化

**問題:**

- CLAUDE.md に開発キットの動作仕様を記述すると、全会話でコンテキストを消費
- 仕様書作成時: 約 40,000 トークン（CLAUDE.md 全体）
- スラッシュコマンド実行時も同様に消費

**解決策:**

- CLAUDE.md から「cc-craft-kit スラッシュコマンドの自動処理」セクションを削除
- スラッシュコマンドファイルに動作仕様を移動
- 必要なときのみスラッシュコマンドファイルが展開される
- 削減されるコンテキスト: 約 10,000〜15,000 トークン/会話

---

## 5. 実装詳細

### 5.1. CLAUDE.md の編集

**削除対象セクション:**

- `## cc-craft-kit スラッシュコマンドの自動処理`
  - `### /cft:spec-phase の動作`
  - `#### tasks フェーズ移行時の自動処理`
  - `#### implementation フェーズ移行時の自動処理`
  - `#### 重要: ブランチ作成について`

**削除範囲:**

- 開始行: 129 (`## cc-craft-kit スラッシュコマンドの自動処理`)
- 終了行: 165 (`- 現在のブランチで実装を進める`) の次の空行まで

**保持するセクション:**

- プロジェクト概要
- ディレクトリ構成
- よく使うコマンド
- アーキテクチャ
- データベーススキーマ
- コーディング規約
- テスト戦略
- トラブルシューティング

### 5.2. スラッシュコマンドファイルの確認

**対象ファイル:**

- `src/slash-commands/spec-phase.md`
- `src/slash-commands/spec-create.md`

**確認内容:**

- `spec-phase.md`: 既に「フェーズ移行後の自動処理」セクションが存在するか確認
  - ✅ 確認結果: 既に存在（61〜108 行目）
  - tasks フェーズの自動処理（67〜73 行目）
  - implementation フェーズの自動処理（77〜100 行目）
  - その他のフェーズの処理（104〜108 行目）

- `spec-create.md`: ブランチ作成に関する仕様が存在するか確認
  - ✅ 確認結果: 既に存在（49〜85 行目）
  - 自動ブランチ作成の動作（49〜64 行目）
  - ブランチ作成後の動作（66〜85 行目）

**結論:**

- 削除する内容は既にスラッシュコマンドファイルに記載されている
- 追加の移動作業は不要

### 5.3. 編集手順

1. **CLAUDE.md の編集**
   - Edit ツールで 129〜165 行目を削除
   - セクション番号の調整は不要（次のセクションは「## アーキテクチャ」で番号なし）

2. **整合性チェック**
   - Read ツールで CLAUDE.md を読み込み、削除が正しく反映されたか確認

3. **動作確認**
   - `/cft:spec-phase` コマンドがスラッシュコマンドファイルの仕様通り動作するか確認
   - 既存の仕様書でフェーズ移行をテスト

---

## 6. 影響範囲

### 6.1. 変更されるファイル

| ファイルパス | 変更内容 | 影響度 |
|---|---|---|
| `CLAUDE.md` | 「cc-craft-kit スラッシュコマンドの自動処理」セクション削除 | 中 |
| `src/slash-commands/spec-phase.md` | 変更なし（既に仕様記載済み） | なし |
| `src/slash-commands/spec-create.md` | 変更なし（既に仕様記載済み） | なし |

### 6.2. 影響を受けるコンポーネント

**影響なし:**

- スラッシュコマンドの動作: 変更なし（仕様は既にスラッシュコマンドファイルに記載）
- コマンド実装（TypeScript）: 変更なし
- データベーススキーマ: 変更なし
- GitHub 連携: 変更なし

**影響あり:**

- Claude Code のコンテキスト消費: 削減（約 10,000〜15,000 トークン/会話）
- 開発者の参照先: CLAUDE.md → スラッシュコマンドファイル

### 6.3. テスト方針

**手動テスト:**

1. `/cft:spec-phase <spec-id> tasks` を実行
   - 自動処理が正常に動作するか確認
   - Read ツールで仕様書読み込み
   - TodoWrite でタスクリスト作成
   - Edit で仕様書更新

2. `/cft:spec-phase <spec-id> implementation` を実行
   - 自動処理が正常に動作するか確認
   - TodoWrite でタスクリスト表示
   - 最初のタスクが in_progress になるか確認

3. CLAUDE.md の内容確認
   - 「cc-craft-kit スラッシュコマンドの自動処理」セクションが削除されているか
   - 他のセクション（アーキテクチャなど）が正常に表示されるか

---

## 7. テスト計画

### 7.1. 単体テスト

**対象:**

- なし（ドキュメント編集のみ）

### 7.2. E2E テスト

#### シナリオ 1: フェーズ移行の自動処理

1. 仕様書作成: `/cft:spec-create "テスト仕様書"`
2. tasks フェーズに移行: `/cft:spec-phase <spec-id> tasks`
3. 検証:
   - 仕様書に「## 8. 実装タスクリスト」セクションが追加されるか
   - TodoWrite でタスクリストが作成されるか

#### シナリオ 2: CLAUDE.md の内容確認

1. CLAUDE.md を読み込み
2. 検証:
   - 「cc-craft-kit スラッシュコマンドの自動処理」セクションが存在しないか
   - アーキテクチャ、コーディング規約などのセクションが残っているか

#### シナリオ 3: スラッシュコマンドファイルの確認

1. `src/slash-commands/spec-phase.md` を読み込み
2. 検証:
   - 「フェーズ移行後の自動処理」セクションが存在するか
   - tasks フェーズ、implementation フェーズの仕様が記載されているか

---

## 8. 実装タスクリスト

### 必須要件の実装

- [ ] **CLAUDE.md からセクション削除**
  - 対象: `## cc-craft-kit スラッシュコマンドの自動処理`セクション全体（129〜165 行目）
  - 確認: Read ツールで削除範囲を特定
  - 実行: Edit ツールで削除

- [ ] **CLAUDE.md の編集内容確認**
  - 削除が正しく反映されたか確認
  - 他のセクション（アーキテクチャなど）が正常に表示されるか確認

### 機能要件の確認

- [ ] **spec-phase.md の動作仕様確認**
  - Read ツールで `src/slash-commands/spec-phase.md` を読み込み
  - 「フェーズ移行後の自動処理」セクションが存在するか確認
  - tasks フェーズ、implementation フェーズの仕様が記載されているか確認

- [ ] **spec-create.md のブランチ作成仕様確認**
  - Read ツールで `src/slash-commands/spec-create.md` を読み込み
  - ブランチ作成に関する仕様が記載されているか確認

### Git コミットと通知

- [ ] **markdownlint エラー修正と Git コミット**
  - markdownlint エラーを修正（強調 → 見出しに変更）
  - `git add .` で変更をステージング
  - `git commit` でコミット

- [ ] **GitHub Issue に更新を通知**
  - `/cft:spec-update a85fe81b` で GitHub Issue に更新を通知

---

## 6. 参考情報

- (参考資料やリンク)
