---
description: "新しい仕様書を作成します"
argument-hint: "<spec-name> [description]"
---

# 仕様書作成

新しい仕様書を作成し、Requirements フェーズから開始します。

## 引数

- `$1` (必須): 仕様書名
- `$2` (オプション): 仕様書の説明

## 実行内容

1. データベースに仕様書レコードを作成
2. Requirements フェーズで初期化
3. 仕様書 ID の発行

## 使用例

```bash
/cft:spec-create "ユーザー認証機能" "メール/パスワード認証とOAuth2.0対応"
```

---

## ブランチ名生成

仕様書作成時、以下の手順でブランチ名を生成してください。

1. **仕様書名と説明を分析**
   - ユーザーが指定した仕様書名（`$1`）と説明（`$2`）を確認
   - 仕様書の内容を理解し、適切な英語の説明フレーズを考案

2. **英語ブランチ名の生成規則**
   - 3〜5 単語程度の簡潔な英語フレーズ
   - 小文字のみ使用
   - 単語の区切りはハイフン（`-`）を使用
   - Git 互換文字のみ（英数字、ハイフン、アンダースコア）
   - 最大 40 文字程度（仕様書 ID と組み合わせて 63 文字以内に収める）

3. **ブランチ名の例**
   - 日本語: "ブランチ名が適当な名前になっている" → 英語: "improve-branch-naming"
   - 日本語: "データベース接続エラーを修正" → 英語: "fix-database-connection"
   - 英語: "Add User Authentication" → 英語: "add-user-authentication"

## 自動ブランチ作成の動作（v0.2.0 以降）

保護ブランチ（`main`、`develop`）から仕様書作成時、自動的に `feature/spec-` プレフィックス付きブランチが作成されます。

**ブランチ命名規則:**

| 実行元ブランチ | カスタムブランチ名 | 生成されるブランチ名 |
|---|---|---|
| feature/* | なし | `spec/<短縮ID>` |
| feature/* | あり | `spec/<短縮ID>-<カスタム名>` |
| **develop** | なし | `feature/spec-<短縮ID>` |
| **develop** | あり | `feature/spec-<短縮ID>-<カスタム名>` |
| **main** | なし | `feature/spec-<短縮ID>` |
| **main** | あり | `feature/spec-<短縮ID>-<カスタム名>` |

この機能により、保護ブランチでの直接作業を防ぎつつ、手動でのブランチ作成の手間を削減します。

## ブランチ作成後の動作（v0.3.0 以降）

仕様書作成時にブランチが自動作成されますが、作成後は**元のブランチに自動的に戻ります**。

- ブランチは作成され、データベースに記録された状態で残ります
- 開発者が意図しないブランチで作業するリスクを防止
- 実装を開始する際は、手動で作成されたブランチに切り替えてください

**実装開始時:**

```bash
# 作成されたブランチに切り替え
git checkout feature/spec-910e63ad
```

**注意事項:**

- ブランチ切り替えに失敗した場合、エラーが発生し、仕様書作成が中断されます
- エラーメッセージに従って手動でブランチを切り替えてください
- ブランチ切り替え失敗の主な原因: 未コミット変更、ファイルロック、Git エラー

---

以下のコマンドを実行して仕様書を作成してください。

**重要**: ブランチ名を生成した場合は、`--branch-name` オプションで渡してください。

```bash
# ブランチ名を生成した場合
npx tsx .cc-craft-kit/commands/spec/create.ts "$1" "$2" --branch-name "<生成したブランチ名>"

# ブランチ名を生成しない場合（フォールバック）
npx tsx .cc-craft-kit/commands/spec/create.ts "$1" "$2"
```

作成が完了したら、結果を要約して表示し、以下の処理を実行してください。

## 作成後の自動処理

重要: 仕様書作成が完了したら、ユーザーに確認を求めずに、以下の処理を**自動的に実行**してください。

1. **仕様書ファイルを読み込む**: Read ツールで `.cc-craft-kit/specs/<spec-id>.md` を読み込む
2. **仕様書の品質レビュー**:
   - Task ツールで `code-reviewer` サブエージェントを実行
   - 仕様書の構造、明確さ、完全性を検証
   - 改善提案があれば、Edit ツールで仕様書を更新

3. **次のアクションを案内**:
   - 仕様書の詳細確認: `/cft:spec-get <spec-id>`
   - デザインフェーズに移行: `/cft:spec-phase <spec-id> design`
