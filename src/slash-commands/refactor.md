---
description: "refactoring-assistant サブエージェントでリファクタリング"
argument-hint: "<file-pattern>"
---

# リファクタリング

`refactoring-assistant` サブエージェントを実行して、コード構造の改善とパフォーマンス最適化を支援します。

## 引数

- `$1` (オプション): 対象ファイルのパターン (例: `src/**/*.ts`、省略時は全プロジェクトファイル)

## 実行内容

1. 指定されたファイルパターンに一致するファイルを検索
2. `refactoring-assistant` サブエージェントを実行してリファクタリング提案を生成
3. 以下の観点で分析：
   - コード重複（DRY 違反）の検出
   - 複雑度の高い関数の特定
   - パフォーマンスボトルネックの発見
   - デザインパターンの適用提案

## 使用例

```bash
# 特定のファイルをリファクタリング
/cft:refactor "src/commands/spec/create.ts"

# ディレクトリ全体をリファクタリング
/cft:refactor "src/commands/**/*.ts"

# プロジェクト全体をリファクタリング
/cft:refactor
```

---

以下のコマンドを実行してリファクタリングを開始してください。

```bash
npx tsx .cc-craft-kit/commands/quality/refactor.ts "$1"
```

## 自動実行フロー

重要: コマンド実行後、ユーザーに確認を求めずに、以下の処理を**自動的に実行**してください。

1. **ファイルパターンの解決**:
   - 引数が指定されている場合: Glob ツールで `$1` パターンに一致するファイルを検索
   - 引数が省略された場合: `src/**/*.ts` を対象とする

2. **refactoring-assistant サブエージェントの実行**:
   - Task ツールで `refactoring-assistant` サブエージェントを起動
   - 対象ファイルごとに以下を分析：
     - Read ツールで対象ファイルを読み込む
     - コード重複（DRY 違反）を検出
     - 複雑度の高い関数を特定（循環的複雑度が高い箇所）
     - パフォーマンスボトルネックを発見

3. **リファクタリング提案の生成**:
   - 発見された問題点をカテゴリ別に整理
   - 優先度（Critical/High/Medium/Low）でソート
   - 各問題に対する具体的なリファクタリング手法を提案

4. **リファクタリングの実施**:
   - Critical/High の問題について、具体的なコード変更案を提示
   - ユーザーの承認を得た後、Edit ツールでリファクタリングを実施
   - 変更後、test-generator サブエージェントでテストを生成
   - 変更後、code-reviewer サブエージェントで品質を再確認

5. **レポート生成**:
   - リファクタリング前後の比較（複雑度、コード行数、重複率）
   - 改善された箇所のサマリー
   - 残存する課題のリスト
