# /cft:test - テスト生成コマンド

test-generator サブエージェントを使用したテスト自動生成。

## 使用方法

```
/cft:test <subcommand> <args...>
```

## サブコマンド

| サブコマンド | 説明 | 使用例 |
|---|---|---|
| `generate <file-pattern>` | テストを生成 | `/cft:test generate src/utils/*.ts` |
| `coverage <file-pattern>` | カバレッジを分析 | `/cft:test coverage src/` |

---

## generate サブコマンド

### 入力
- `<file-pattern>`: テスト対象のファイルパターン

### 実行手順

1. **対象ファイルの特定**
   Glob でファイルを検索

2. **既存テストの確認**
   - `__tests__/` ディレクトリ
   - `*.test.ts`, `*.spec.ts` ファイル
   - `tests/` ディレクトリ

3. **test-generator サブエージェントを起動**

   Task ツールで `test-generator` サブエージェントを起動:

   ```
   以下のファイルに対してユニットテストを生成してください:

   <ファイルリスト>

   要件:
   1. テストフレームワーク: Jest（または既存のフレームワークに合わせる）
   2. カバレッジ目標: 80%以上
   3. テストケース:
      - 正常系
      - 境界値
      - エラーケース
      - エッジケース
   4. モック:
      - 外部依存は適切にモック
      - ファイルI/O、ネットワーク、DBはモック必須
   5. 命名規則:
      - describe: 対象の機能/クラス名
      - it: 「〜すべき」形式

   出力:
   - テストファイルの内容
   - テストケース一覧
   - モックの説明
   ```

4. **テストファイルを作成**
   - 既存のテストディレクトリ構造に合わせる
   - なければ `__tests__/` に作成

5. **結果を報告**

---

## coverage サブコマンド

### 入力
- `<file-pattern>`: 分析対象のファイルパターン

### 実行手順

1. **対象ファイルの特定**
   Glob でファイルを検索

2. **既存テストの検索**
   対応するテストファイルを検索

3. **カバレッジを分析**
   - テストファイルがある場合: 実行してカバレッジ取得
   - テストファイルがない場合: 「テストなし」として報告

4. **レポートを生成**

---

## 出力形式

### generate 成功時

```
## テスト生成完了

| 項目 | 値 |
|---|---:|
| 対象ファイル | N |
| 生成テストファイル | N |
| テストケース数 | N |

### 生成ファイル

| ファイル | テストケース数 |
|---|---:|
| `__tests__/utils.test.ts` | 12 |
| `__tests__/helpers.test.ts` | 8 |

### 次のステップ

1. テストを実行: `npm test`
2. カバレッジ確認: `npm run test:coverage`
```

### coverage 結果

```
## カバレッジレポート

| ファイル | 行 | 分岐 | 関数 | ステータス |
|---|---:|---:|---:|---|
| `src/utils.ts` | 85% | 72% | 90% | ✅ |
| `src/helpers.ts` | 45% | 30% | 50% | ⚠️ |
| `src/index.ts` | 0% | 0% | 0% | ❌ テストなし |

### 推奨アクション

- ⚠️ `src/helpers.ts`: 分岐カバレッジが低い（エッジケース追加推奨）
- ❌ `src/index.ts`: テストを作成してください
```

---

## オプション

| オプション | 説明 | デフォルト |
|---|---|---|
| `--framework <name>` | テストフレームワーク | 自動検出 |
| `--style <style>` | テストスタイル（unit/integration） | `unit` |
| `--overwrite` | 既存テストを上書き | `false` |

---

## テストフレームワーク自動検出

以下の順序で検出:

1. `package.json` の `devDependencies` を確認
   - `jest` → Jest
   - `vitest` → Vitest
   - `mocha` → Mocha
2. 既存テストファイルのインポートを確認
3. 検出できない場合は Jest をデフォルト

---

## エラーハンドリング

| エラー | 対処 |
|---|---|
| ファイルが見つからない | パターンを確認するよう案内 |
| テストフレームワーク未検出 | `--framework` で明示的に指定を案内 |
| 既存テストあり | `--overwrite` オプションを案内 |
