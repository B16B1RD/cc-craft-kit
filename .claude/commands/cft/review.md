# /cft:review - コードレビューコマンド

code-reviewer サブエージェントを使用したコードレビュー。

## 使用方法

```
/cft:review <file-pattern>
```

## 引数

- `<file-pattern>`: レビュー対象のファイルパターン（glob 形式）
  - 例: `src/**/*.ts`
  - 例: `lib/utils.js`
  - 例: `.` （カレントディレクトリ全体）

---

## 実行手順

### 入力の解析

ユーザー入力: `$ARGUMENTS`

ファイルパターンが指定されていない場合:
- 直近の git diff から変更ファイルを取得
- `git diff --name-only HEAD~1` または `git diff --name-only --staged`

---

## レビュー実行

### 1. 対象ファイルの特定

```bash
# パターンからファイルリストを取得
```
Glob パターンでファイルを検索

### 2. code-reviewer サブエージェントを起動

Task ツールで `code-reviewer` サブエージェントを起動:

```
以下のファイルをレビューしてください:

<ファイルリスト>

レビュー観点:
1. コード品質
   - 可読性
   - 保守性
   - DRY 原則
   - SOLID 原則

2. セキュリティ
   - 入力バリデーション
   - 認証・認可
   - インジェクション対策
   - 機密情報の扱い

3. パフォーマンス
   - 計算量
   - メモリ使用
   - N+1 問題
   - 不要な処理

4. ベストプラクティス
   - 言語・フレームワーク固有の慣習
   - エラーハンドリング
   - ログ出力
   - テスタビリティ

出力形式:
- 問題の重要度（Critical/High/Medium/Low）
- 該当箇所（ファイル:行番号）
- 問題の説明
- 推奨される修正方法
```

### 3. 結果の整形

サブエージェントからの結果を整形して出力。

---

## 出力形式

### サマリー

```
## コードレビュー結果

| 重要度 | 件数 |
|---|---:|
| 🔴 Critical | N |
| 🟠 High | N |
| 🟡 Medium | N |
| 🔵 Low | N |

対象ファイル: N 件
```

### 詳細

```
### 🔴 Critical

#### 1. [ファイル名:行番号] 問題タイトル

**問題:**
<問題の説明>

**推奨修正:**
<修正方法>

---
```

---

## オプション

| オプション | 説明 | デフォルト |
|---|---|---|
| `--severity <level>` | 表示する最低重要度 | `low` |
| `--security-only` | セキュリティ問題のみ | `false` |
| `--fix` | 自動修正を試みる | `false` |

---

## 連携機能

### 仕様書との連携

現在のブランチに関連する仕様書がある場合:
1. ブランチ名から仕様書を特定
2. 仕様書の受け入れ基準と照合
3. 基準違反があれば報告

### PR との連携

`--pr` オプション指定時:
1. PR の差分ファイルを対象に
2. レビューコメントを PR に投稿
```bash
gh pr review --comment --body "<レビュー結果>"
```

---

## エラーハンドリング

| エラー | 対処 |
|---|---|
| ファイルが見つからない | パターンを確認するよう案内 |
| 対象ファイルが多すぎる | パターンを絞るよう案内（50ファイル超） |
| サブエージェント失敗 | エラー詳細を表示 |
